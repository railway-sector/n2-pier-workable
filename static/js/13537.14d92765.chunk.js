"use strict";(self.webpackChunkn2_pier_workable=self.webpackChunkn2_pier_workable||[]).push([[8775,13537,96141],{7150:(e,t,n)=>{n.d(t,{K:()=>c});var r=n(15941),s=n(68930),o=n(20664),i=n(9392);const a=-1;function c(e,t,n){const r=e.vertices.position,s=e.vertices.componentIndex,i=g.position0,c=g.position1,u=g.faceNormal0,f=g.faceNormal1,{edges:p,normals:y}=l(e),w=p.length/4,v=t.allocate(w);let S=0;const _=w,A=n?.allocate(_);let O=0,E=0,L=0;h.length=0;for(let a=0;a<w;++a){const e=4*a;r.getVec(p.data[e],i),r.getVec(p.data[e+1],c);const t=h.pushNew();t.index=4*a,t.length=(0,o.j)(i,c)}h.sort((e,t)=>t.length-e.length);const C=new Array,b=new Array;h.forAll(e=>{let{length:l,index:h}=e;const w=p.data[h],_=p.data[h+1],k=p.data[h+2],M=p.data[h+3],T=M===a;if(r.getVec(w,i),r.getVec(_,c),T){const e=3*k;(0,o.i)(u,y.data[e],y.data[e+1],y.data[e+2]),(0,o.c)(f,u),g.componentIndex=s.get(w),g.cosAngle=(0,o.e)(u,f)}else{let e=3*k;if((0,o.i)(u,y.data[e],y.data[e+1],y.data[e+2]),e=3*M,(0,o.i)(f,y.data[e],y.data[e+1],y.data[e+2]),g.componentIndex=s.get(w),g.cosAngle=(0,o.e)(u,f),function(e,t){return e.cosAngle>t}(g,I))return;g.cosAngle<-.9999&&(0,o.c)(f,u)}E+=l,L++,T||function(e,t){return e.cosAngle<t}(g,N)?(t.write(v,S++,g),C.push(l)):d(g,m)&&(A&&n&&n.write(A,O++,g),b.push(l))});const k=new Float32Array(C.reverse()),M=new Float32Array(b.reverse()),T=A&&n?{instancesData:A.slice(0,O),lodInfo:{lengths:M}}:void 0;return{regular:{instancesData:v.slice(0,S),lodInfo:{lengths:k}},silhouette:T,averageEdgeLength:E/L}}function d(e,t){const n=(0,r.XM)(e.cosAngle);return(0,o.E)(w,e.position1,e.position0),n*((0,o.e)((0,o.h)(y,e.faceNormal0,e.faceNormal1),w)>0?-1:1)>t}function l(e){const t=e.faces.length/3,n=e.faces,r=e.neighbors,s=e.vertices.position;f.length=p.length=0;for(let i=0;i<t;i++){const e=3*i,t=r[e],c=r[e+1],d=r[e+2],l=n[e],u=n[e+1],h=n[e+2];s.getVec(l,v),s.getVec(u,S),s.getVec(h,_),(0,o.d)(S,S,v),(0,o.d)(_,_,v),(0,o.h)(v,S,_),(0,o.n)(v,v),p.pushArray(v),(t===a||l<u)&&(f.push(l),f.push(u),f.push(i),f.push(t)),(c===a||u<h)&&(f.push(u),f.push(h),f.push(i),f.push(c)),(d===a||h<l)&&(f.push(h),f.push(l),f.push(i),f.push(d))}return{edges:f,normals:p}}class u{constructor(){this.index=0,this.length=0}}const h=new s.A({allocator:e=>e||new u,deallocator:null}),f=new s.A({deallocator:null}),p=new s.A({deallocator:null}),g=new class{constructor(){this.position0=(0,i.vt)(),this.position1=(0,i.vt)(),this.faceNormal0=(0,i.vt)(),this.faceNormal1=(0,i.vt)(),this.componentIndex=0,this.cosAngle=0}},y=(0,i.vt)(),w=(0,i.vt)(),v=(0,i.vt)(),S=(0,i.vt)(),_=(0,i.vt)(),m=(0,r.kU)(4),I=Math.cos(m),A=(0,r.kU)(35),N=Math.cos(A)},8775:(e,t,n)=>{n.d(t,{o6:()=>l,extractComponentsEdgeLocationsLayout:()=>y,hx:()=>u,Jb:()=>g});var r=n(77176);function s(e,t,n){const r=t/3,s=new Uint32Array(n+1),o=new Uint32Array(n+1),i=(e,t)=>{e<t?s[e+1]++:o[t+1]++};for(let w=0;w<r;w++){const t=e[3*w],n=e[3*w+1],r=e[3*w+2];i(t,n),i(n,r),i(r,t)}let a=0,c=0;for(let w=0;w<n;w++){const e=s[w+1],t=o[w+1];s[w+1]=a,o[w+1]=c,a+=e,c+=t}const d=new Uint32Array(6*r),l=s[n],u=(e,t,n)=>{if(e<t){const r=s[e+1]++;d[2*r]=t,d[2*r+1]=n}else{const r=o[t+1]++;d[2*l+2*r]=e,d[2*l+2*r+1]=n}};for(let w=0;w<r;w++){const t=e[3*w],n=e[3*w+1],r=e[3*w+2];u(t,n,w),u(n,r,w),u(r,t,w)}const h=(e,t)=>{const n=2*e,r=t-e;for(let s=1;s<r;s++){const e=d[n+2*s],t=d[n+2*s+1];let r=s-1;for(;r>=0&&d[n+2*r]>e;r--)d[n+2*r+2]=d[n+2*r],d[n+2*r+3]=d[n+2*r+1];d[n+2*r+2]=e,d[n+2*r+3]=t}};for(let w=0;w<n;w++)h(s[w],s[w+1]),h(l+o[w],l+o[w+1]);const f=new Int32Array(3*r),p=(t,n)=>t===e[3*n]?0:t===e[3*n+1]?1:t===e[3*n+2]?2:-1,g=(e,t)=>{const n=p(e,t);f[3*t+n]=-1},y=(e,t,n,r)=>{const s=p(e,t);f[3*t+s]=r;const o=p(n,r);f[3*r+o]=t};for(let w=0;w<n;w++){let e=s[w];const t=s[w+1];let n=o[w];const r=o[w+1];for(;e<t&&n<r;){const t=d[2*e],r=d[2*l+2*n];t===r?(y(w,d[2*e+1],r,d[2*l+2*n+1]),e++,n++):t<r?(g(w,d[2*e+1]),e++):(g(r,d[2*l+2*n+1]),n++)}for(;e<t;)g(w,d[2*e+1]),e++;for(;n<r;)g(d[2*l+2*n],d[2*l+2*n+1]),n++}return f}var o=n(48549),i=n(66470),a=n(96141),c=n(69413),d=n(7150);function l(e){const t=u(e.data,e.skipDeduplicate,e.indices,e.indicesLength);return f.updateSettings(e.writerSettings),p.updateSettings(e.writerSettings),(0,d.K)(t,f,p)}function u(e,t,n,o){if(t){const t=s(n,o,e.count);return new h(n,o,t,e)}const i=(0,r.b)(e.buffer,e.stride/4,{originalIndices:n}),c=s(i.indices,o,i.uniqueCount);return{faces:i.indices,facesLength:i.indices.length,neighbors:c,vertices:a.EdgeInputBufferLayout.createView(i.buffer)}}class h{constructor(e,t,n,r){this.faces=e,this.facesLength=t,this.neighbors=n,this.vertices=r}}const f=new c.T,p=new c.k,g=(0,o.BP)().vec3f(i.r.POSITION0).vec3f(i.r.POSITION1),y=(0,o.BP)().vec3f(i.r.POSITION0).vec3f(i.r.POSITION1).u16(i.r.COMPONENTINDEX)},12580:(e,t,n)=>{n.d(t,{L:()=>s,s:()=>o});var r=n(48549);function s(e,t){return t.push(e.buffer),{buffer:e.buffer,layout:new r.l5(e.layout)}}function o(e){return new r.q3(e.layout).createView(e.buffer)}},13537:(e,t,n)=>{n.r(t),n.d(t,{SceneLayerSnappingSource:()=>N});var r=n(35143),s=n(91967),o=n(18690),i=n(50346),a=n(46053),c=(n(81806),n(76460),n(85842)),d=n(54901),l=n(30726),u=(n(47249),n(19451)),h=n(74527),f=n(9392),p=n(12016),g=n(78315),y=n(23862),w=n(9876),v=n(72317);let S=class extends s.A{constructor(e){super(e),this.availability=0,this._ids=new Set}destroy(){this._workerHandle.destroy(),this._workerHandle=null}initialize(){this._workerHandle=new _(this.schedule,{fetchAllEdgeLocations:(e,t)=>this._fetchAllEdgeLocations(e,t)})}async fetchCandidates(e,t){const n=e.coordinateHelper,{point:r}=e,s=m;this.renderCoordsHelper.toRenderCoords(r,n.spatialReference,s);const o=e.distance,i="number"==typeof o?o:o.distance,a=await this._workerHandle.invoke({bounds:(0,g.f)(s[0],s[1],s[2],i),returnEdge:e.returnEdge,returnVertex:"none"!==e.vertexMode},t);return a.candidates.sort((e,t)=>e.distance-t.distance),a.candidates.map(e=>this._convertCandidate(n,e))}async add(e,t){this._ids.add(e.id),await this._workerHandle.invokeMethod("add",e,t)}async remove(e,t){this._ids.delete(e.id),await this._workerHandle.invokeMethod("remove",e,t)}_convertCandidate(e,t){switch(t.type){case"edge":return new w.z({objectId:t.objectId,targetPoint:(0,y.de)(this._convertRenderCoordinate(e,t.target)),edgeStart:this._convertRenderCoordinate(e,t.start),edgeEnd:this._convertRenderCoordinate(e,t.end),isDraped:!1});case"vertex":return new v.C({objectId:t.objectId,targetPoint:(0,y.de)(this._convertRenderCoordinate(e,t.target)),isDraped:!1})}}_convertRenderCoordinate(e,t){let{spatialReference:n}=e;const r=(0,f.vt)();return this.renderCoordsHelper.fromRenderCoords(t,r,n),(0,y._7)(r)}async _fetchAllEdgeLocations(e,t){const n=[],r=[];for(const{id:s,uid:o}of e.components)this._ids.has(s)&&n.push((async()=>{const e=await this.fetchEdgeLocations(s,t.signal),n=e.locations.buffer;return r.push(n),{id:s,uid:o,objectIds:e.objectIds,locations:n,origin:e.origin,type:e.type}})());return{result:{components:(await Promise.all(n)).filter(e=>{let{id:t}=e;return this._ids.has(t)})},transferList:r}}};(0,r._)([(0,a.MZ)({constructOnly:!0})],S.prototype,"renderCoordsHelper",void 0),(0,r._)([(0,a.MZ)({constructOnly:!0})],S.prototype,"fetchEdgeLocations",void 0),(0,r._)([(0,a.MZ)({constructOnly:!0})],S.prototype,"schedule",void 0),(0,r._)([(0,a.MZ)({readOnly:!0})],S.prototype,"availability",void 0),S=(0,r._)([(0,c.$)("esri.views.interactive.snapping.featureSources.sceneLayerSource.SceneLayerSnappingSourceWorkerHandle")],S);class _ extends p.B{constructor(e,t){super("SceneLayerSnappingSourceWorker","fetchCandidates",{},e,{strategy:"dedicated",client:t})}}const m=(0,f.vt)();let I=class extends s.A{get updating(){return this._updatingHandles.updating}constructor(e){super(e),this.availability=1,this._updatingHandles=new u.U,this._abortController=new AbortController}destroy(){this._tracker=(0,l.xt)(this._tracker),this._abortController=(0,l.DC)(this._abortController),this._updatingHandles.destroy()}initialize(){const{view:e}=this,t=e.resourceController;this._edgeWorker=new h.U(A(t)),this._workerHandle=new S({renderCoordsHelper:this.view.renderCoordsHelper,schedule:A(t),fetchEdgeLocations:async(e,t)=>{if(null==this._tracker)throw new Error("tracker-not-initialized");return this._tracker.fetchEdgeLocations(e,this._edgeWorker,t)}}),this._updatingHandles.addPromise(this._setupLayerView()),this.addHandles([(0,d.DQ)(this._workerHandle),(0,d.DQ)(this._edgeWorker)])}async fetchCandidates(e,t){return this._workerHandle.fetchCandidates(e,t)}refresh(){}async _setupLayerView(){if(this.destroyed)return;const e=this._abortController?.signal,t=await this.getLayerView();null==t||(0,i.G4)(e)||(this._tracker=t.trackSnappingSources({add:(t,n)=>{this._updatingHandles.addPromise(this._workerHandle.add({id:t,bounds:n},e))},remove:t=>{this._updatingHandles.addPromise(this._workerHandle.remove({id:t},e))}}))}};function A(e){return t=>e.immediate.schedule(t)}(0,r._)([(0,a.MZ)({constructOnly:!0})],I.prototype,"getLayerView",void 0),(0,r._)([(0,a.MZ)({constructOnly:!0})],I.prototype,"view",void 0),(0,r._)([(0,a.MZ)({readOnly:!0})],I.prototype,"updating",null),(0,r._)([(0,a.MZ)({readOnly:!0})],I.prototype,"availability",void 0),I=(0,r._)([(0,c.$)("esri.views.interactive.snapping.featureSources.I3SSnappingSource")],I);let N=class extends s.A{get updating(){return this._i3sSources.some(e=>e.updating)}constructor(e){super(e),this.availability=1,this._i3sSources=[]}destroy(){this._i3sSources.forEach(e=>e.destroy()),this._i3sSources.length=0}initialize(){const{view:e}=this,t=this.layerSource.layer;this._i3sSources="building-scene"===t.type?this._getBuildingSceneI3SSources(e,t):[this._getSceneLayerI3SSource(e,t)]}async fetchCandidates(e,t){const n=await Promise.all(this._i3sSources.map(n=>n.fetchCandidates(e,t)));return(0,i.Te)(t),n.flat()}refresh(){this._i3sSources.forEach(e=>e.refresh())}_getBuildingSceneI3SSources(e,t){return t.allSublayers.toArray().map(n=>"building-component"===n.type?new I({getLayerView:async()=>(await e.whenLayerView(t)).whenSublayerView(n),view:e}):null).filter(o.Ru)}_getSceneLayerI3SSource(e,t){return new I({getLayerView:async()=>{const n=await e.whenLayerView(t);return"scene-layer-graphics-3d"===n.type?void 0:n},view:e})}};(0,r._)([(0,a.MZ)({constructOnly:!0})],N.prototype,"layerSource",void 0),(0,r._)([(0,a.MZ)({constructOnly:!0})],N.prototype,"view",void 0),(0,r._)([(0,a.MZ)({readOnly:!0})],N.prototype,"updating",null),(0,r._)([(0,a.MZ)({readOnly:!0})],N.prototype,"availability",void 0),N=(0,r._)([(0,c.$)("esri.views.interactive.snapping.featureSources.SceneLayerSnappingSource")],N)},23241:(e,t,n)=>{n.d(t,{_:()=>o});var r=n(20664),s=n(64753);class o extends s.m{constructor(e,t,n){super(t,n),this.point=e}equals(e){return e instanceof o&&(0,r.q)(this.point,e.point)}}},69413:(e,t,n)=>{n.d(t,{T:()=>w,k:()=>v});var r=n(47249),s=n(20664),o=n(9392),i=n(57481),a=n(25672),c=n(96141);class d{updateSettings(e){this.settings=e,this._edgeHashFunction=e.reducedPrecision?p:f}write(e,t,n){_.seed=this._edgeHashFunction(n);const r=_.getIntRange(0,255),s=_.getIntRange(0,this.settings.variants-1),o=_.getFloat(),i=255*(.5*function(e,t){return Math.abs(e)**t*Math.sign(e)}(-(1-Math.min(o/.7,1))+Math.max(0,o-.7)/(1-.7),1.2)+.5);e.position0.setVec(t,n.position0),e.position1.setVec(t,n.position1),e.componentIndex.set(t,n.componentIndex),e.variantOffset.set(t,r),e.variantStroke.set(t,s),e.variantExtension.set(t,i)}}const l=new Float32Array(6),u=new Uint32Array(l.buffer),h=new Uint32Array(1);function f(e){return l[0]=e.position0[0],l[1]=e.position0[1],l[2]=e.position0[2],l[3]=e.position1[0],l[4]=e.position1[1],l[5]=e.position1[2],h[0]=31*(31*(31*(31*(31*(166811+u[0])+u[1])+u[2])+u[3])+u[4])+u[5],h[0]}function p(e){const t=l;t[0]=y(e.position0[0]),t[1]=y(e.position0[1]),t[2]=y(e.position0[2]),t[3]=y(e.position1[0]),t[4]=y(e.position1[1]),t[5]=y(e.position1[2]),h[0]=5381;for(let n=0;n<u.length;n++)h[0]=31*h[0]+u[n];return h[0]}const g=1e4;function y(e){return Math.round(e*g)/g}class w{constructor(){this._commonWriter=new d}updateSettings(e){this._commonWriter.updateSettings(e)}allocate(e){return c.gr.createBuffer(e)}write(e,t,n){this._commonWriter.write(e,t,n),(0,s.f)(S,n.faceNormal0,n.faceNormal1),(0,s.n)(S,S);const{typedBuffer:r,typedBufferStride:o}=e.normalCompressed;(0,a.aT)(r,t,S[0],S[1],S[2],o)}static#e=(()=>this.Layout=c.gr)();static#t=(()=>this.glLayout=(0,i.U)(c.gr,1))()}class v{constructor(){this._commonWriter=new d}updateSettings(e){this._commonWriter.updateSettings(e)}allocate(e){return c.In.createBuffer(e)}write(e,t,n){this._commonWriter.write(e,t,n);{const{typedBuffer:r,typedBufferStride:s}=e.normalCompressed;(0,a.aT)(r,t,n.faceNormal0[0],n.faceNormal0[1],n.faceNormal0[2],s)}{const{typedBuffer:r,typedBufferStride:s}=e.normal2Compressed;(0,a.aT)(r,t,n.faceNormal1[0],n.faceNormal1[1],n.faceNormal1[2],s)}}static#e=(()=>this.Layout=c.In)();static#t=(()=>this.glLayout=(0,i.U)(c.In,1))()}const S=(0,o.vt)(),_=new r.A},72317:(e,t,n)=>{n.d(t,{C:()=>i});var r=n(75543),s=n(61751),o=n(23241);class i extends s.w{constructor(e){super({...e,constraint:new r.i7(e.targetPoint)})}get hints(){return[new o._(this.targetPoint,this.isDraped,this.domain)]}}},74527:(e,t,n)=>{n.d(t,{U:()=>a});var r=n(78393),s=n(12016),o=n(12580),i=n(8775);class a extends s.B{constructor(e){super("EdgeProcessingWorker","extract",{extract:e=>[e.dataBuffer],extractComponentsEdgeLocations:e=>[e.dataBuffer],extractEdgeLocations:e=>[e.dataBuffer]},e)}async process(e,t,n){return n?(0,i.o6)(e):function(e){return{regular:{instancesData:(0,o.s)(e.regular.instancesData),lodInfo:{lengths:new Float32Array(e.regular.lodInfo.lengths)}},silhouette:{instancesData:(0,o.s)(e.silhouette.instancesData),lodInfo:{lengths:new Float32Array(e.silhouette.lodInfo.lengths)}},averageEdgeLength:e.averageEdgeLength}}(await this.invoke(new c(e),t))}async extractEdgeLocations(e,t){const n=await this.invokeMethod("extractEdgeLocations",new c(e),t);return(0,o.s)(n)}async extractComponentsEdgeLocations(e,t){const n=await this.invokeMethod("extractComponentsEdgeLocations",new c(e),t);return(0,o.s)(n)}}class c{constructor(e){this.dataBuffer=e.data.buffer,this.writerSettings=e.writerSettings,this.skipDeduplicate=e.skipDeduplicate,this.indices=(0,r.iu)(e.indices)?e.indices.buffer:e.indices,this.indicesType=(0,r.iu)(e.indices)?(0,r.XJ)(e.indices)?"Uint32Array":"Uint16Array":"Array",this.indicesLength=e.indicesLength}}},77176:(e,t,n)=>{n.d(t,{b:()=>o});var r=n(15941),s=n(38496);function o(e,t,n){const o=Array.isArray(e),l=o?e.length/t:e.byteLength/(4*t),u=o?e:new Uint32Array(e,0,l*t),h=n?.minReduction??0,f=n?.originalIndices||null,p=f?f.length:0,g=n?.componentOffsets||null;let y=0;if(g)for(let r=0;r<g.length-1;r++){const e=g[r+1]-g[r];e>y&&(y=e)}else y=l;const w=Math.floor(1.1*y)+1;(null==d||d.length<2*w)&&(d=new Uint32Array((0,r.cU)(2*w)));for(let r=0;r<2*w;r++)d[r]=0;let v=0;const S=!!g&&!!f,_=S?p:l;let m=(0,s.my)(l);const I=new Uint32Array(p),A=1.96;let N=0!==h?Math.ceil(4*A*A/(h*h)*h*(1-h)):_,O=1,E=g?g[1]:_;for(let r=0;r<_;r++){if(r===N){const e=1-v/r;if(e+A*Math.sqrt(e*(1-e)/r)<h)return null;N*=2}if(r===E){for(let e=0;e<2*w;e++)d[e]=0;if(f)for(let e=g[O-1];e<g[O];e++)I[e]=m[f[e]];E=g[++O]}const e=S?f[r]:r,n=e*t,s=c(u,n,t);let o=s%w,a=v;for(;0!==d[2*o+1];){if(d[2*o]===s){const e=d[2*o+1]-1;if(i(u,n,e*t,t)){a=m[e];break}}o++,o>=w&&(o-=w)}a===v&&(d[2*o]=s,d[2*o+1]=e+1,v++),m[e]=a}if(0!==h&&1-v/l<h)return null;if(S){for(let e=g[O-1];e<I.length;e++)I[e]=m[f[e]];m=(0,s.uW)(I)}const L=o?new Array(v):new Uint32Array(v*t);v=0;for(let r=0;r<_;r++)m[r]===v&&(a(u,(S?f[r]:r)*t,L,v*t,t),v++);if(f&&!S){const e=new Uint32Array(p);for(let t=0;t<e.length;t++)e[t]=m[f[t]];m=(0,s.uW)(e)}return{buffer:Array.isArray(L)?L:L.buffer,indices:m,uniqueCount:v}}function i(e,t,n,r){for(let s=0;s<r;s++)if(e[t+s]!==e[n+s])return!1;return!0}function a(e,t,n,r,s){for(let o=0;o<s;o++)n[r+o]=e[t+o]}function c(e,t,n){let r=0;for(let s=0;s<n;s++)r=e[t+s]+r|0,r=r+(r<<11)+(r>>>2)|0;return r>>>0}let d=null},96141:(e,t,n)=>{n.d(t,{EdgeInputBufferLayout:()=>i,In:()=>l,gr:()=>d,vG:()=>u,vJ:()=>a,wO:()=>c});var r=n(57481),s=n(48549),o=n(66470);const i=(0,s.BP)().vec3f(o.r.POSITION).u16(o.r.COMPONENTINDEX).freeze(),a=(0,s.BP)().vec2u8(o.r.SIDENESS).freeze(),c=(0,r.U)(a),d=(0,s.BP)().vec3f(o.r.POSITION0).vec3f(o.r.POSITION1).vec2i16(o.r.NORMALCOMPRESSED).u16(o.r.COMPONENTINDEX).u8(o.r.VARIANTOFFSET,{glNormalized:!0}).u8(o.r.VARIANTSTROKE).u8(o.r.VARIANTEXTENSION,{glNormalized:!0}).freeze(),l=(0,s.BP)().vec3f(o.r.POSITION0).vec3f(o.r.POSITION1).vec2i16(o.r.NORMALCOMPRESSED).vec2i16(o.r.NORMAL2COMPRESSED).u16(o.r.COMPONENTINDEX).u8(o.r.VARIANTOFFSET,{glNormalized:!0}).u8(o.r.VARIANTSTROKE).u8(o.r.VARIANTEXTENSION,{glNormalized:!0}).freeze(),u=new Map([[o.r.POSITION0,0],[o.r.POSITION1,1],[o.r.COMPONENTINDEX,2],[o.r.VARIANTOFFSET,3],[o.r.VARIANTSTROKE,4],[o.r.VARIANTEXTENSION,5],[o.r.NORMALCOMPRESSED,6],[o.r.NORMAL2COMPRESSED,7],[o.r.SIDENESS,8]])}}]);
//# sourceMappingURL=13537.14d92765.chunk.js.map