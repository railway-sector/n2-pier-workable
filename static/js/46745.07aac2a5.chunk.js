"use strict";(self.webpackChunkn2_pier_workable=self.webpackChunkn2_pier_workable||[]).push([[46745],{46745:(e,t,n)=>{n.r(t),n.d(t,{TextureCompressionWorkerOutput:()=>d,compress:()=>p,compressRGBADataToKTX2:()=>C,createTextureDataKTX2:()=>T,initializeBasisEncoder:()=>w,initializeDXTEncoder:()=>f});var r=n(28899);let a;var s=n(45235);let l;var i=n(93345);let o,c,u=null,h=null;class d{constructor(e,t){this.internalFormat=e,this.compressedTexture=t}}async function p(e){let t;if(t=e.data instanceof ImageBitmap?function(e){const t=new OffscreenCanvas(e.width,e.height),n=t.getContext("2d");return n.drawImage(e,0,0),n.getImageData(0,0,t.width,t.height).data}(e.data):function(e,t,n,r,a){const s=new Uint8ClampedArray(e).subarray(0,t*n*r);if(!a)return s;const l=new Uint8ClampedArray(s.length),i=t*r;for(let o=0;o<n;o++){const e=o*i,t=(n-o-1)*i;l.set(s.subarray(e,e+i),t)}return l}(e.data,e.width,e.height,e.components,e.needsFlip),e.hasS3TC){h||await f();const n=new Uint8Array(t.length);if(h?.encode(t,e.width,e.height,e.preMultiplyAlpha,n)){const e=function(e,t){const n=new Int32Array(e.buffer,e.byteOffset,m);let r,a;switch(n[b]){case R:r=8,a=i.CQ.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case X:r=16,a=i.CQ.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case B:r=16,a=i.CQ.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return null}let s=1,l=n[E],o=n[g];(3&l||3&o)&&(l=l+3&-4,o=o+3&-4);const c=l,u=o;let h,d;n[A]&S&&!1!==t&&(s=Math.max(1,n[_]));let p=e.byteOffset+n[y]+4;const w=[];for(let i=0;i<s;++i)d=(l+3>>2)*(o+3>>2)*r,h=new Uint8Array(e.buffer,p,d),w.push(h),p+=d,l=Math.max(1,l>>1),o=Math.max(1,o>>1);return{textureData:{type:"compressed",levels:w},internalFormat:a,width:c,height:u}}(n,!0),t=[n.buffer];return{result:new d(e?.internalFormat??null,e?.textureData??null),transferList:t}}return{result:new d(null,null)}}if(e.hasETC){if(u||await w(),e.preMultiplyAlpha&&!h&&await f(),e.preMultiplyAlpha){const n=new Uint8ClampedArray(t.length);h?.premultiply(new Uint8Array(t),e.width,e.height,n),t=n}const n=await C(t,e.width,e.height,e.hasMipmap),r=n?await T(n):null,a=r?.compressedTexture?.levels.map(e=>e.buffer)||[];return{result:new d(r?.internalFormat??null,r?.compressedTexture??null),transferList:a}}return{result:new d(null,null)}}async function w(){u||(u=await(o??=(a??=(async()=>{const e=await n.e(56378).then(n.bind(n,56378)),t=await e.default({locateFile:e=>(0,r.s)(`esri/libs/basisu/${e}`)});return t.initializeBasis(),t})(),a)))}async function f(){h||(h=await(c??=(l??=(async()=>{const e=await n.e(53996).then(n.bind(n,53996));return await e.default({locateFile:e=>(0,r.s)(`esri/libs/dxtEncoder/${e}`)})})(),l)))}async function C(e,t,n,r){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:255,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,l=arguments.length>6&&void 0!==arguments[6]&&arguments[6],i=arguments.length>7&&void 0!==arguments[7]&&arguments[7];if(!u)return null;const o=new u.BasisEncoder;o.setPerceptual(!i),o.setCheckForAlpha(!0),o.setForceAlpha(!1),o.setRenormalize(i),o.setMipGen(r),o.setMipSRGB(!i),o.setCreateKTX2File(!0),o.setKTX2SRGBTransferFunc(!i),o.setQualityLevel(a),o.setCompressionLevel(s);const c=new Uint8Array(e.byteLength);o.setSliceSourceImage(0,new Uint8Array(e),t,n,l);const h=o.encode(c),d=new Uint8Array(c.buffer,0,h),p=new u.KTX2File(new Uint8Array(d));return p.isValid()?(o.delete(),d):(p.close(),p.delete(),o.delete(),null)}async function T(e){if(!u)return new d(null,null);const t=new u.KTX2File(new Uint8Array(e));t.startTranscoding();const[n,r]=t.getHasAlpha()?[s.n.ETC2_RGBA,i.CQ.COMPRESSED_RGBA8_ETC2_EAC]:[s.n.ETC1_RGB,i.CQ.COMPRESSED_RGB8_ETC2],a=t.getLevels(),l=[];for(let s=0;s<a;s++)l.push(new Uint8Array(t.getImageTranscodedSizeInBytes(s,0,0,n))),t.transcodeImage(l[s],s,0,0,n,0,-1,-1);return t.close(),t.delete(),{internalFormat:r,compressedTexture:{type:"compressed",levels:l}}}const m=31,y=1,A=2,g=3,E=4,_=7,b=21,S=131072;function D(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}const R=D("DXT1"),X=D("DXT3"),B=D("DXT5")}}]);
//# sourceMappingURL=46745.07aac2a5.chunk.js.map