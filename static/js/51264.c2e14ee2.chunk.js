"use strict";(self.webpackChunkn2_pier_workable=self.webpackChunkn2_pier_workable||[]).push([[8775,51264,96141],{7150:(t,e,n)=>{n.d(e,{K:()=>a});var o=n(15941),s=n(68930),r=n(20664),i=n(9392);const c=-1;function a(t,e,n){const o=t.vertices.position,s=t.vertices.componentIndex,i=p.position0,a=p.position1,d=p.faceNormal0,h=p.faceNormal1,{edges:g,normals:m}=l(t),N=g.length/4,I=e.allocate(N);let A=0;const v=N,E=n?.allocate(v);let _=0,y=0,T=0;f.length=0;for(let c=0;c<N;++c){const t=4*c;o.getVec(g.data[t],i),o.getVec(g.data[t+1],a);const e=f.pushNew();e.index=4*c,e.length=(0,r.j)(i,a)}f.sort((t,e)=>e.length-t.length);const b=new Array,P=new Array;f.forAll(t=>{let{length:l,index:f}=t;const N=g.data[f],v=g.data[f+1],C=g.data[f+2],L=g.data[f+3],M=L===c;if(o.getVec(N,i),o.getVec(v,a),M){const t=3*C;(0,r.i)(d,m.data[t],m.data[t+1],m.data[t+2]),(0,r.c)(h,d),p.componentIndex=s.get(N),p.cosAngle=(0,r.e)(d,h)}else{let t=3*C;if((0,r.i)(d,m.data[t],m.data[t+1],m.data[t+2]),t=3*L,(0,r.i)(h,m.data[t],m.data[t+1],m.data[t+2]),p.componentIndex=s.get(N),p.cosAngle=(0,r.e)(d,h),function(t,e){return t.cosAngle>e}(p,S))return;p.cosAngle<-.9999&&(0,r.c)(h,d)}y+=l,T++,M||function(t,e){return t.cosAngle<e}(p,O)?(e.write(I,A++,p),b.push(l)):u(p,w)&&(E&&n&&n.write(E,_++,p),P.push(l))});const C=new Float32Array(b.reverse()),L=new Float32Array(P.reverse()),M=E&&n?{instancesData:E.slice(0,_),lodInfo:{lengths:L}}:void 0;return{regular:{instancesData:I.slice(0,A),lodInfo:{lengths:C}},silhouette:M,averageEdgeLength:y/T}}function u(t,e){const n=(0,o.XM)(t.cosAngle);return(0,r.E)(N,t.position1,t.position0),n*((0,r.e)((0,r.h)(m,t.faceNormal0,t.faceNormal1),N)>0?-1:1)>e}function l(t){const e=t.faces.length/3,n=t.faces,o=t.neighbors,s=t.vertices.position;h.length=g.length=0;for(let i=0;i<e;i++){const t=3*i,e=o[t],a=o[t+1],u=o[t+2],l=n[t],d=n[t+1],f=n[t+2];s.getVec(l,I),s.getVec(d,A),s.getVec(f,v),(0,r.d)(A,A,I),(0,r.d)(v,v,I),(0,r.h)(I,A,v),(0,r.n)(I,I),g.pushArray(I),(e===c||l<d)&&(h.push(l),h.push(d),h.push(i),h.push(e)),(a===c||d<f)&&(h.push(d),h.push(f),h.push(i),h.push(a)),(u===c||f<l)&&(h.push(f),h.push(l),h.push(i),h.push(u))}return{edges:h,normals:g}}class d{constructor(){this.index=0,this.length=0}}const f=new s.A({allocator:t=>t||new d,deallocator:null}),h=new s.A({deallocator:null}),g=new s.A({deallocator:null}),p=new class{constructor(){this.position0=(0,i.vt)(),this.position1=(0,i.vt)(),this.faceNormal0=(0,i.vt)(),this.faceNormal1=(0,i.vt)(),this.componentIndex=0,this.cosAngle=0}},m=(0,i.vt)(),N=(0,i.vt)(),I=(0,i.vt)(),A=(0,i.vt)(),v=(0,i.vt)(),w=(0,o.kU)(4),S=Math.cos(w),E=(0,o.kU)(35),O=Math.cos(E)},8775:(t,e,n)=>{n.d(e,{o6:()=>l,extractComponentsEdgeLocationsLayout:()=>m,hx:()=>d,Jb:()=>p});var o=n(77176);function s(t,e,n){const o=e/3,s=new Uint32Array(n+1),r=new Uint32Array(n+1),i=(t,e)=>{t<e?s[t+1]++:r[e+1]++};for(let N=0;N<o;N++){const e=t[3*N],n=t[3*N+1],o=t[3*N+2];i(e,n),i(n,o),i(o,e)}let c=0,a=0;for(let N=0;N<n;N++){const t=s[N+1],e=r[N+1];s[N+1]=c,r[N+1]=a,c+=t,a+=e}const u=new Uint32Array(6*o),l=s[n],d=(t,e,n)=>{if(t<e){const o=s[t+1]++;u[2*o]=e,u[2*o+1]=n}else{const o=r[e+1]++;u[2*l+2*o]=t,u[2*l+2*o+1]=n}};for(let N=0;N<o;N++){const e=t[3*N],n=t[3*N+1],o=t[3*N+2];d(e,n,N),d(n,o,N),d(o,e,N)}const f=(t,e)=>{const n=2*t,o=e-t;for(let s=1;s<o;s++){const t=u[n+2*s],e=u[n+2*s+1];let o=s-1;for(;o>=0&&u[n+2*o]>t;o--)u[n+2*o+2]=u[n+2*o],u[n+2*o+3]=u[n+2*o+1];u[n+2*o+2]=t,u[n+2*o+3]=e}};for(let N=0;N<n;N++)f(s[N],s[N+1]),f(l+r[N],l+r[N+1]);const h=new Int32Array(3*o),g=(e,n)=>e===t[3*n]?0:e===t[3*n+1]?1:e===t[3*n+2]?2:-1,p=(t,e)=>{const n=g(t,e);h[3*e+n]=-1},m=(t,e,n,o)=>{const s=g(t,e);h[3*e+s]=o;const r=g(n,o);h[3*o+r]=e};for(let N=0;N<n;N++){let t=s[N];const e=s[N+1];let n=r[N];const o=r[N+1];for(;t<e&&n<o;){const e=u[2*t],o=u[2*l+2*n];e===o?(m(N,u[2*t+1],o,u[2*l+2*n+1]),t++,n++):e<o?(p(N,u[2*t+1]),t++):(p(o,u[2*l+2*n+1]),n++)}for(;t<e;)p(N,u[2*t+1]),t++;for(;n<o;)p(u[2*l+2*n],u[2*l+2*n+1]),n++}return h}var r=n(48549),i=n(66470),c=n(96141),a=n(69413),u=n(7150);function l(t){const e=d(t.data,t.skipDeduplicate,t.indices,t.indicesLength);return h.updateSettings(t.writerSettings),g.updateSettings(t.writerSettings),(0,u.K)(e,h,g)}function d(t,e,n,r){if(e){const e=s(n,r,t.count);return new f(n,r,e,t)}const i=(0,o.b)(t.buffer,t.stride/4,{originalIndices:n}),a=s(i.indices,r,i.uniqueCount);return{faces:i.indices,facesLength:i.indices.length,neighbors:a,vertices:c.EdgeInputBufferLayout.createView(i.buffer)}}class f{constructor(t,e,n,o){this.faces=t,this.facesLength=e,this.neighbors=n,this.vertices=o}}const h=new a.T,g=new a.k,p=(0,r.BP)().vec3f(i.r.POSITION0).vec3f(i.r.POSITION1),m=(0,r.BP)().vec3f(i.r.POSITION0).vec3f(i.r.POSITION1).u16(i.r.COMPONENTINDEX)},51264:(t,e,n)=>{n.r(e),n.d(e,{default:()=>g});var o=n(35143),s=n(50346),r=(n(76460),n(81806),n(47249),n(50076),n(85842)),i=n(20664),c=n(9392),a=n(44230),u=n(78315),l=n(94536),d=n(8775);function f(t,e,n){const o=(0,u.c)(),s=(0,u.a)(o);return(0,i.b)(s,s,t,.5),(0,i.b)(s,s,e,.5),o[3]=(0,i.j)(s,t),(0,i.f)(s,s,n),o}let h=class{constructor(){this._idToComponent=new Map,this._components=new l.A(t=>t.bounds),this._edges=new l.A(t=>t.bounds),this._tmpLineSegment=(0,a.vt)(),this._tmpP1=(0,c.vt)(),this._tmpP2=(0,c.vt)(),this._tmpP3=(0,c.vt)(),this.remoteClient=null}async fetchCandidates(t,e){await Promise.resolve(),(0,s.Te)(e),await this._ensureEdgeLocations(t,e);const n=[];return this._edges.forEachNeighbor(e=>(this._addCandidates(t,e,n),n.length<1e3),t.bounds),{result:{candidates:n}}}async _ensureEdgeLocations(t,e){const n=[];if(this._components.forEachNeighbor(t=>{if(null==t.info){const{id:e,uid:o}=t;n.push({id:e,uid:o})}return!0},t.bounds),!n.length)return;const o={components:n},s=await this.remoteClient.invoke("fetchAllEdgeLocations",o,e??{});for(const r of s.components)this._setFetchEdgeLocations(r)}async add(t){const e=new m(t.id,t.bounds);return this._idToComponent.set(e.id,e),this._components.add([e]),{result:{}}}async remove(t){const e=this._idToComponent.get(t.id);if(e){const t=[];this._edges.forEachNeighbor(n=>(n.component===e&&t.push(n),!0),e.bounds),this._edges.remove(t),this._components.remove([e]),this._idToComponent.delete(e.id)}return{result:{}}}_setFetchEdgeLocations(t){const e=this._idToComponent.get(t.id);if(null==e||t.uid!==e.uid)return;const n=d.extractComponentsEdgeLocationsLayout.createView(t.locations),o=new Array(n.count),s=(0,c.vt)(),r=(0,c.vt)();for(let c=0;c<n.count;c++){n.position0.getVec(c,s),n.position1.getVec(c,r);const i=f(s,r,t.origin),a=new N(e,c,i);o[c]=a}this._edges.add(o);const{objectIds:i,origin:a}=t;e.info={locations:n,objectIds:i,origin:a}}_addCandidates(t,e,n){const{info:o}=e.component,{origin:s,objectIds:r}=o,c=o.locations,a=c.position0.getVec(e.index,this._tmpP1),u=c.position1.getVec(e.index,this._tmpP2);(0,i.f)(a,a,s),(0,i.f)(u,u,s);const l=r[c.componentIndex.get(e.index)];this._addEdgeCandidate(t,l,a,u,n),p(t,l,a,n),p(t,l,u,n)}_addEdgeCandidate(t,e,n,o,s){if(!t.returnEdge)return;const r=(0,u.a)(t.bounds),l=(0,a.Cr)(n,o,this._tmpLineSegment),d=(0,a._I)(l,r,this._tmpP3);(0,u.o)(t.bounds,d)&&s.push({type:"edge",objectId:e,target:(0,c.o8)(d),distance:(0,i.j)(r,d),start:(0,c.o8)(n),end:(0,c.o8)(o)})}};h=(0,o._)([(0,r.$)("esri.views.interactive.snapping.featureSources.sceneLayerSource.SceneLayerSnappingSourceWorker")],h);const g=h;function p(t,e,n,o){if(!t.returnVertex||!(0,u.o)(t.bounds,n))return;const s=(0,u.a)(t.bounds);o.push({type:"vertex",objectId:e,target:(0,c.o8)(n),distance:(0,i.j)(s,n)})}class m{constructor(t,e){this.id=t,this.bounds=e,this.info=null,this.uid=++m.uid}static#t=(()=>this.uid=0)()}class N{constructor(t,e,n){this.component=t,this.index=e,this.bounds=n}}},69413:(t,e,n)=>{n.d(e,{T:()=>N,k:()=>I});var o=n(47249),s=n(20664),r=n(9392),i=n(57481),c=n(25672),a=n(96141);class u{updateSettings(t){this.settings=t,this._edgeHashFunction=t.reducedPrecision?g:h}write(t,e,n){v.seed=this._edgeHashFunction(n);const o=v.getIntRange(0,255),s=v.getIntRange(0,this.settings.variants-1),r=v.getFloat(),i=255*(.5*function(t,e){return Math.abs(t)**e*Math.sign(t)}(-(1-Math.min(r/.7,1))+Math.max(0,r-.7)/(1-.7),1.2)+.5);t.position0.setVec(e,n.position0),t.position1.setVec(e,n.position1),t.componentIndex.set(e,n.componentIndex),t.variantOffset.set(e,o),t.variantStroke.set(e,s),t.variantExtension.set(e,i)}}const l=new Float32Array(6),d=new Uint32Array(l.buffer),f=new Uint32Array(1);function h(t){return l[0]=t.position0[0],l[1]=t.position0[1],l[2]=t.position0[2],l[3]=t.position1[0],l[4]=t.position1[1],l[5]=t.position1[2],f[0]=31*(31*(31*(31*(31*(166811+d[0])+d[1])+d[2])+d[3])+d[4])+d[5],f[0]}function g(t){const e=l;e[0]=m(t.position0[0]),e[1]=m(t.position0[1]),e[2]=m(t.position0[2]),e[3]=m(t.position1[0]),e[4]=m(t.position1[1]),e[5]=m(t.position1[2]),f[0]=5381;for(let n=0;n<d.length;n++)f[0]=31*f[0]+d[n];return f[0]}const p=1e4;function m(t){return Math.round(t*p)/p}class N{constructor(){this._commonWriter=new u}updateSettings(t){this._commonWriter.updateSettings(t)}allocate(t){return a.gr.createBuffer(t)}write(t,e,n){this._commonWriter.write(t,e,n),(0,s.f)(A,n.faceNormal0,n.faceNormal1),(0,s.n)(A,A);const{typedBuffer:o,typedBufferStride:r}=t.normalCompressed;(0,c.aT)(o,e,A[0],A[1],A[2],r)}static#t=(()=>this.Layout=a.gr)();static#e=(()=>this.glLayout=(0,i.U)(a.gr,1))()}class I{constructor(){this._commonWriter=new u}updateSettings(t){this._commonWriter.updateSettings(t)}allocate(t){return a.In.createBuffer(t)}write(t,e,n){this._commonWriter.write(t,e,n);{const{typedBuffer:o,typedBufferStride:s}=t.normalCompressed;(0,c.aT)(o,e,n.faceNormal0[0],n.faceNormal0[1],n.faceNormal0[2],s)}{const{typedBuffer:o,typedBufferStride:s}=t.normal2Compressed;(0,c.aT)(o,e,n.faceNormal1[0],n.faceNormal1[1],n.faceNormal1[2],s)}}static#t=(()=>this.Layout=a.In)();static#e=(()=>this.glLayout=(0,i.U)(a.In,1))()}const A=(0,r.vt)(),v=new o.A},77176:(t,e,n)=>{n.d(e,{b:()=>r});var o=n(15941),s=n(38496);function r(t,e,n){const r=Array.isArray(t),l=r?t.length/e:t.byteLength/(4*e),d=r?t:new Uint32Array(t,0,l*e),f=n?.minReduction??0,h=n?.originalIndices||null,g=h?h.length:0,p=n?.componentOffsets||null;let m=0;if(p)for(let o=0;o<p.length-1;o++){const t=p[o+1]-p[o];t>m&&(m=t)}else m=l;const N=Math.floor(1.1*m)+1;(null==u||u.length<2*N)&&(u=new Uint32Array((0,o.cU)(2*N)));for(let o=0;o<2*N;o++)u[o]=0;let I=0;const A=!!p&&!!h,v=A?g:l;let w=(0,s.my)(l);const S=new Uint32Array(g),E=1.96;let O=0!==f?Math.ceil(4*E*E/(f*f)*f*(1-f)):v,_=1,y=p?p[1]:v;for(let o=0;o<v;o++){if(o===O){const t=1-I/o;if(t+E*Math.sqrt(t*(1-t)/o)<f)return null;O*=2}if(o===y){for(let t=0;t<2*N;t++)u[t]=0;if(h)for(let t=p[_-1];t<p[_];t++)S[t]=w[h[t]];y=p[++_]}const t=A?h[o]:o,n=t*e,s=a(d,n,e);let r=s%N,c=I;for(;0!==u[2*r+1];){if(u[2*r]===s){const t=u[2*r+1]-1;if(i(d,n,t*e,e)){c=w[t];break}}r++,r>=N&&(r-=N)}c===I&&(u[2*r]=s,u[2*r+1]=t+1,I++),w[t]=c}if(0!==f&&1-I/l<f)return null;if(A){for(let t=p[_-1];t<S.length;t++)S[t]=w[h[t]];w=(0,s.uW)(S)}const T=r?new Array(I):new Uint32Array(I*e);I=0;for(let o=0;o<v;o++)w[o]===I&&(c(d,(A?h[o]:o)*e,T,I*e,e),I++);if(h&&!A){const t=new Uint32Array(g);for(let e=0;e<t.length;e++)t[e]=w[h[e]];w=(0,s.uW)(t)}return{buffer:Array.isArray(T)?T:T.buffer,indices:w,uniqueCount:I}}function i(t,e,n,o){for(let s=0;s<o;s++)if(t[e+s]!==t[n+s])return!1;return!0}function c(t,e,n,o,s){for(let r=0;r<s;r++)n[o+r]=t[e+r]}function a(t,e,n){let o=0;for(let s=0;s<n;s++)o=t[e+s]+o|0,o=o+(o<<11)+(o>>>2)|0;return o>>>0}let u=null},96141:(t,e,n)=>{n.d(e,{EdgeInputBufferLayout:()=>i,In:()=>l,gr:()=>u,vG:()=>d,vJ:()=>c,wO:()=>a});var o=n(57481),s=n(48549),r=n(66470);const i=(0,s.BP)().vec3f(r.r.POSITION).u16(r.r.COMPONENTINDEX).freeze(),c=(0,s.BP)().vec2u8(r.r.SIDENESS).freeze(),a=(0,o.U)(c),u=(0,s.BP)().vec3f(r.r.POSITION0).vec3f(r.r.POSITION1).vec2i16(r.r.NORMALCOMPRESSED).u16(r.r.COMPONENTINDEX).u8(r.r.VARIANTOFFSET,{glNormalized:!0}).u8(r.r.VARIANTSTROKE).u8(r.r.VARIANTEXTENSION,{glNormalized:!0}).freeze(),l=(0,s.BP)().vec3f(r.r.POSITION0).vec3f(r.r.POSITION1).vec2i16(r.r.NORMALCOMPRESSED).vec2i16(r.r.NORMAL2COMPRESSED).u16(r.r.COMPONENTINDEX).u8(r.r.VARIANTOFFSET,{glNormalized:!0}).u8(r.r.VARIANTSTROKE).u8(r.r.VARIANTEXTENSION,{glNormalized:!0}).freeze(),d=new Map([[r.r.POSITION0,0],[r.r.POSITION1,1],[r.r.COMPONENTINDEX,2],[r.r.VARIANTOFFSET,3],[r.r.VARIANTSTROKE,4],[r.r.VARIANTEXTENSION,5],[r.r.NORMALCOMPRESSED,6],[r.r.NORMAL2COMPRESSED,7],[r.r.SIDENESS,8]])}}]);
//# sourceMappingURL=51264.c2e14ee2.chunk.js.map