"use strict";(self.webpackChunkn2_pier_workable=self.webpackChunkn2_pier_workable||[]).push([[8149,15757,54090],{357:(e,t,o)=>{o.d(t,{A:()=>h});var i=o(35143),a=o(91967),r=o(46053),s=(o(81806),o(76460),o(47249),o(85842));let n=class extends a.A{constructor(e){super(e),this.mode="absolute-height"}toJSON(){return{mode:this.mode}}};(0,i._)([(0,r.MZ)({type:String,nonNullable:!0})],n.prototype,"mode",void 0),n=(0,i._)([(0,s.$)("esri.views.interactive.sketch.SketchTooltipElevationOptions")],n);let p=class extends a.A{constructor(e){super(e),this.area=!0,this.coordinates=!0,this.direction=!0,this.distance=!0,this.elevation=!0,this.header=!0,this.helpMessage=!1,this.orientation=!0,this.radius=!0,this.rotation=!0,this.scale=!0,this.size=!0,this.totalLength=!0}};(0,i._)([(0,r.MZ)({type:Boolean,nonNullable:!0})],p.prototype,"area",void 0),(0,i._)([(0,r.MZ)({type:Boolean,nonNullable:!0})],p.prototype,"coordinates",void 0),(0,i._)([(0,r.MZ)({type:Boolean,nonNullable:!0})],p.prototype,"direction",void 0),(0,i._)([(0,r.MZ)({type:Boolean,nonNullable:!0})],p.prototype,"distance",void 0),(0,i._)([(0,r.MZ)({type:Boolean,nonNullable:!0})],p.prototype,"elevation",void 0),(0,i._)([(0,r.MZ)({type:Boolean,nonNullable:!0})],p.prototype,"header",void 0),(0,i._)([(0,r.MZ)({type:Boolean,nonNullable:!0})],p.prototype,"helpMessage",void 0),(0,i._)([(0,r.MZ)({type:Boolean,nonNullable:!0})],p.prototype,"orientation",void 0),(0,i._)([(0,r.MZ)({type:Boolean,nonNullable:!0})],p.prototype,"radius",void 0),(0,i._)([(0,r.MZ)({type:Boolean,nonNullable:!0})],p.prototype,"rotation",void 0),(0,i._)([(0,r.MZ)({type:Boolean,nonNullable:!0})],p.prototype,"scale",void 0),(0,i._)([(0,r.MZ)({type:Boolean,nonNullable:!0})],p.prototype,"size",void 0),(0,i._)([(0,r.MZ)({type:Boolean,nonNullable:!0})],p.prototype,"totalLength",void 0),p=(0,i._)([(0,s.$)("esri.views.interactive.sketch.SketchTooltipVisibleElements")],p);const l=p;let c=class extends a.A{constructor(e){super(e),this.enabled=!1,this.forceEnabled=!1,this.helpMessage=null,this.helpMessageIcon=null,this.inputEnabled=!0,this.elevation=new n,this.placement="auto",this.offset=null,this.visibleElements=new l,this.visualVariables=null,this.xyMode="auto"}get effectiveEnabled(){return this.forceEnabled||this.enabled}};(0,i._)([(0,r.MZ)({type:Boolean,nonNullable:!0})],c.prototype,"enabled",void 0),(0,i._)([(0,r.MZ)()],c.prototype,"forceEnabled",void 0),(0,i._)([(0,r.MZ)()],c.prototype,"effectiveEnabled",null),(0,i._)([(0,r.MZ)()],c.prototype,"helpMessage",void 0),(0,i._)([(0,r.MZ)()],c.prototype,"helpMessageIcon",void 0),(0,i._)([(0,r.MZ)({type:Boolean,nonNullable:!0})],c.prototype,"inputEnabled",void 0),(0,i._)([(0,r.MZ)({type:n,nonNullable:!0})],c.prototype,"elevation",void 0),(0,i._)([(0,r.MZ)()],c.prototype,"placement",void 0),(0,i._)([(0,r.MZ)()],c.prototype,"offset",void 0),(0,i._)([(0,r.MZ)({type:l,nonNullable:!0})],c.prototype,"visibleElements",void 0),(0,i._)([(0,r.MZ)()],c.prototype,"visualVariables",void 0),(0,i._)([(0,r.MZ)()],c.prototype,"xyMode",void 0),c=(0,i._)([(0,s.$)("esri.views.interactive.sketch.SketchTooltipOptions")],c);const h=c},3689:(e,t,o)=>{o.d(t,{Y:()=>r});o(81806);var i=o(12482),a=o(61492);function r(e){if(e.graphic&&"graphics"!==e.graphic.layer?.type)return a.d.GRAPHICS_LAYER_MISSING;const t=e.operations?.data.type;if(!t)return a.d.GEOMETRY_TYPE_UNSUPPORTED;switch(t){case"polygon":case"point":case"polyline":case"mesh":break;default:return a.d.GEOMETRY_TYPE_UNSUPPORTED}const o=e.elevationInfo;return(0,i.wz)(o)?a.d.ELEVATION_MODE_UNSUPPORTED:a.d.SUPPORTED}},28330:(e,t,o)=>{o.d(t,{E:()=>n});var i=o(78009),a=o(66678);const r=e=>({autoAreaByElevationMode(t,o){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,i.u0)();if("on-the-ground"===o){const o=e.geodesicArea(t);return null!=o?o:(0,i.qh)(t,a)}return(0,i.EI)(t,a)},autoArea2D(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,i.u0)();return this.autoAreaByElevationMode(e,"on-the-ground",t)}});let s=null;async function n(){return s||(s=r(await(0,a.c)())),s}},54090:(e,t,o)=>{o.d(t,{RouteLayerInteraction:()=>fe});var i=o(35143),a=o(91967),r=o(54901),s=o(30726),n=o(68134),p=o(46053),l=(o(81806),o(76460)),c=(o(47249),o(85842)),h=o(19451),d=o(63733),u=o(57562),y=o(26170),g=o(95808),v=o(75747),m=o(19276),_=o(50076),f=o(54099),b=o(50346),w=o(34111),M=o(9956),E=o(5262),O=o(80963),G=o(31933),T=o(84847),S=o(94918),A=o(86875),k=o(7246),P=o(76940),R=o(671),C=o(61492),D=o(3689),I=o(12482);function U(e){return function(e){if(e.graphic&&"graphics"!==e.graphic.layer?.type)return{result:C.d.GRAPHICS_LAYER_MISSING};if(!e.operations)return{result:C.d.GEOMETRY_MISSING};if((0,I.wz)(e.elevationInfo))return{result:C.d.ELEVATION_MODE_UNSUPPORTED};const t=e.operations.data.type,o=e.operations.data.geometry;return"point"===t||"mesh"===t||"polyline"===t||"polygon"===t?{result:C.d.SUPPORTED,geometry:o}:{result:C.d.GEOMETRY_TYPE_UNSUPPORTED}}(e).result}var H=o(69120),Z=o(57308),N=o(82307),L=o(95327),x=o(97513),B=o(357),V=o(73265),F=o(64344),Y=o(83973),j=o(70330),q=o(28330),W=o(68655),K=o(1723),z=o(53787),$=o(11500),Q=o(4212);let X=class extends f.A.EventedAccessor{constructor(e){super(e),this.cancelled=!1,this.history={undo:[],redo:[]},this.type=null}get tool(){if(!this.activeComponent)return null;switch(this.activeComponent.type){case"graphic-mover":case"move-3d":return"move";case"box":case"transform-3d":return"transform";case"reshape":case"reshape-3d":return"reshape";case"draw-2d":case"draw-3d":return this.activeComponent.geometryType;default:(0,Q.Xb)(this.activeComponent)}return null}addToHistory(e){this.history.redo=[],this.history.undo.push(e)}resetHistory(){this.history.redo=[],this.history.undo=[]}canUndo(){return this.history.undo.length>0}canRedo(){return this.history.redo.length>0}complete(){this._reset(),this.onEnd(),this.emit("complete")}cancel(){this.cancelled=!0,this.complete()}_reset(){this.activeComponent?.reset()}refreshComponent(){const e=this.activeComponent;e&&("box"!==e.type&&"reshape"!==e.type&&"graphic-mover"!==e.type||e.refresh())}set undo(e){this._set("undo",()=>{this.canUndo()&&e()})}set redo(e){this._set("redo",()=>{this.canRedo()&&e()})}};(0,i._)([(0,p.MZ)()],X.prototype,"activeComponent",void 0),(0,i._)([(0,p.MZ)()],X.prototype,"cancelled",void 0),(0,i._)([(0,p.MZ)()],X.prototype,"history",void 0),(0,i._)([(0,p.MZ)()],X.prototype,"tool",null),(0,i._)([(0,p.MZ)()],X.prototype,"type",void 0),(0,i._)([(0,p.MZ)()],X.prototype,"canUndo",null),(0,i._)([(0,p.MZ)()],X.prototype,"canRedo",null),(0,i._)([(0,p.MZ)()],X.prototype,"onEnd",void 0),(0,i._)([(0,p.MZ)()],X.prototype,"undo",null),(0,i._)([(0,p.MZ)()],X.prototype,"redo",null),(0,i._)([(0,p.MZ)()],X.prototype,"toggleTool",void 0),(0,i._)([(0,p.MZ)()],X.prototype,"addToSelection",void 0),(0,i._)([(0,p.MZ)()],X.prototype,"removeFromSelection",void 0),X=(0,i._)([(0,c.$)("esri.widgets.Sketch.support.OperationHandle")],X);let J=class extends X{};(0,i._)([(0,p.MZ)()],J.prototype,"activeComponent",void 0),J=(0,i._)([(0,c.$)("esri.widgets.Sketch.support.OperationHandle.CreateOperationHandle")],J);let ee=class extends X{};var te,oe;(0,i._)([(0,p.MZ)()],ee.prototype,"activeComponent",void 0),ee=(0,i._)([(0,c.$)("esri.widgets.Sketch.support.OperationHandle.UpdateOperationHandle")],ee),(oe=te||(te={}))[oe.ForceCollapse=-1]="ForceCollapse",oe[oe.Low=0]="Low",oe[oe.Medium=10]="Medium",oe[oe.High=100]="High",oe[oe.Max=1e3]="Max";const ie={defaultZ:0},ae={reshapeOptions:{edgeOperation:"split",shapeOperation:"move",vertexOperation:"move"},enableMoveAllGraphics:!0,enableRotation:!0,enableScaling:!0,multipleSelectionEnabled:!0,preserveAspectRatio:!1,toggleToolOnClick:!0,enableZ:!0,highlightOptions:{enabled:!0,name:K.Tv},tool:"transform"};let re=class extends f.A.EventedAccessor{constructor(e){super(e),this._defaultSnappingManager=null,this._updatingHandles=new h.U,this._internalGraphicsLayer=new d.A({listMode:"hide",internal:!0,title:"SVM Internal"}),this._operationHandle=null,this._viewHandlesKey="viewHandles",this.activeFillSymbol=null,this.activeLineSymbol=null,this.activeVertexSymbol=null,this.allowDeleteKey=!0,this.layer=null,this.pointSymbol=new P.A({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.polygonSymbol=new A.A({color:[150,150,150,.2],outline:{color:[50,50,50],width:2}}),this.polylineSymbol=new k.A({color:[130,130,130,1],width:2}),this.meshSymbol=new S.A({symbolLayers:new m.A([new T.A])}),this.updateGraphics=new m.A,this.updateOnGraphicClick=!0,this.creationMode="single",this.vertexSymbol=new P.A({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.sketchOptions=new x.A,this._moduleLoaderAbortController=null,this._viewReadyAbortController=null,this._sketchContinuationFlag=!1,this._originalPopupEnabled=null,this.defaultCreateOptions=ie,this.defaultUpdateOptions=ae,this.snappingOptions=e?.snappingManager?.options??e?.snappingOptions??new Y.A}initialize(){this.addHandles([(0,n.on)(()=>this.view?.map?.layers,"change",e=>{e.removed.includes(this.layer)&&this.cancel()}),(0,n.on)(()=>this.layer?.graphics,"change",e=>{if(null!=this._operationHandle)for(const t of e.removed)this.updateGraphics.includes(t)&&(this.updateGraphics.length>1?this._operationHandle.removeFromSelection(t):this._operationHandle.cancel())}),(0,n.wB)(()=>this.layer?.elevationInfo??null,e=>{e!==this._internalGraphicsLayer.elevationInfo&&(this.cancel(),this._internalGraphicsLayer.elevationInfo=e)},n.pc),(0,n.wB)(()=>this.view,e=>{this._defaultSnappingManager=(0,s.pR)(this._defaultSnappingManager),e&&(this.snappingManager||(this._defaultSnappingManager=new F.g({view:e,options:this.snappingOptions})),"2d"===e.type?Promise.all([o.e(26871),o.e(16364),o.e(82103),o.e(48045),o.e(59833),o.e(55903),o.e(41010),o.e(53141),o.e(63404)]).then(o.bind(o,45924)):"3d"===e.type&&(Promise.all([o.e(26871),o.e(16364),o.e(82103),o.e(48045),o.e(59833),o.e(86928),o.e(1307),o.e(55903),o.e(32488),o.e(41010),o.e(88577),o.e(53141),o.e(85893),o.e(96999),o.e(24743),o.e(30416)]).then(o.bind(o,24743)),Promise.all([o.e(31918),o.e(53046),o.e(14276)]).then(o.bind(o,42208))))},n.pc),(0,n.wB)(()=>this.view?.spatialReference,(e,t)=>{e&&t&&!e.equals(t)&&this.cancel()})]),(0,j.BY)(this)}destroy(){this.cancel(),this._removeDefaultLayer(),this._defaultSnappingManager=(0,s.pR)(this._defaultSnappingManager),this._set("snappingManager",null),this._set("view",null),this._updatingHandles.destroy(),this.emit("destroy")}get updating(){return this._updatingHandles.updating||null!=this.snappingManager&&this.snappingManager.updating}get activeTool(){return this._operationHandle?.tool??null}get activeCreateToolDrawMode(){return"create"===this._operationHandle?.type&&this._operationHandle.activeComponent&&"mode"in this._operationHandle.activeComponent?this._operationHandle.activeComponent.mode:null}get activeTooltip(){const{activeComponent:e,destroyed:t}=this,o=!t&&e&&"tooltip"in e?e.tooltip:null;return o?.visible?o:null}get activeComponent(){return this._operationHandle?.activeComponent??null}get createGraphic(){return null==this.activeComponent||"draw-3d"!==this.activeComponent.type&&"draw-2d"!==this.activeComponent.type?this._get("createGraphic"):this.activeComponent.graphic}get defaultCreateOptions(){return this._get("defaultCreateOptions")}set defaultCreateOptions(e){this._set("defaultCreateOptions",{...ie,...e})}get defaultUpdateOptions(){return this._get("defaultUpdateOptions")}set defaultUpdateOptions(e){this._set("defaultUpdateOptions",{...ae,...e,reshapeOptions:{...ae.reshapeOptions,...e?.reshapeOptions},highlightOptions:{...ae.highlightOptions,...e?.highlightOptions}})}get labelOptions(){return this.sketchOptions.labels}set labelOptions(e){this.sketchOptions.labels=e}get snappingOptions(){return this.snappingManager?.options??this._get("snappingOptions")}set snappingOptions(e){null!=this._defaultSnappingManager&&(this._defaultSnappingManager.options=e),this._set("snappingOptions",e)}get snappingManager(){return this._isOverridden("snappingManager")&&this._get("snappingManager"),this._defaultSnappingManager}set snappingManager(e){if(e)this._isOverridden("snappingManager")||(this._defaultSnappingManager=(0,s.pR)(this._defaultSnappingManager)),this._override("snappingManager",e);else{const{view:e}=this;!this._defaultSnappingManager&&e&&(this._defaultSnappingManager=new F.g({options:this.snappingOptions,view:e})),this._clearOverride("snappingManager")}}get state(){const e=!(!this.view?.ready||!this.layer),t=this._operationHandle;return e&&t?"active":e?"ready":"disabled"}get tooltipOptions(){return this.sketchOptions.tooltips}set tooltipOptions(e){this.sketchOptions.tooltips=e}get valueOptions(){return this.sketchOptions.values}set valueOptions(e){this.sketchOptions.values=e}get view(){return this._get("view")}set view(e){const t=this._get("view");if(t){const{container:e,map:o}=t;e&&(t.cursor=null),o?.remove(this._internalGraphicsLayer),this.removeHandles(this._viewHandlesKey),this.cancel()}const o="view-ready";this.removeHandles(o),e&&this.addHandles((0,n.z7)(()=>e.ready,t=>{this.removeHandles(this._viewHandlesKey),t&&this.addHandles(this._generateViewHandles(e),this._viewHandlesKey)},n.pc),o),this._set("view",e)}cancel(){this._moduleLoaderAbortController=(0,s.DC)(this._moduleLoaderAbortController),this._viewReadyAbortController=(0,s.DC)(this._viewReadyAbortController),this._sketchContinuationFlag=!0,this._operationHandle&&this._operationHandle.cancel()}complete(){this._operationHandle&&this._operationHandle.complete()}delete(){const{state:e,updateGraphics:t}=this;if("active"===e&&t.length){const{activeTool:e,layer:o}=this,i=t.toArray();o.removeMany(i),this.cancel(),this._emitDeleteEvent({graphics:i,tool:e})}}duplicate(){if("active"===this.state&&this.updateGraphics.length){const e=this.updateGraphics.map(e=>e.clone()).toArray();return this.layer.addMany(e),this.emit("duplicate",{graphics:e,type:"duplicate"}),e}return[]}async create(e,t){this.cancel(),await this._waitViewReady();const{view:o,layer:i}=this;if(!o||"disabled"===this.state)throw i||this._logMissingLayer(),(0,b.NK)();if(null!=o.activeTool&&(o.activeTool=null),!e)return void this._logError("sketch:missing-parameter","Missing parameter 'tool'.");(0,H.Y3)(o,this._internalGraphicsLayer);const a=await this._updatingHandles.addPromise(this._setupCreateOperation(e,t));if(null==a||this.destroyed)return void o.map.remove(this._internalGraphicsLayer);a.on("complete",()=>{if(a===this._operationHandle){const o=this.createGraphic,r=this._operationHandle.cancelled;if(this._operationHandle.destroy(),this._operationHandle=null,this._set("createGraphic",null),this.view?.map&&this.view.map.remove(this._internalGraphicsLayer),a.cancelled||null==o||i.add(o),this._sketchContinuationFlag=!1,this.emit("create",{graphic:o,state:r?"cancel":"complete",tool:e,toolEventInfo:null,type:"create"}),r||this._sketchContinuationFlag)return;const{creationMode:s}=this;if("continuous"===s){if(t?.geometryToPlace)return;this._updatingHandles.addPromise((0,b.QZ)(this.create(e,t)))}else"update"===s&&o&&this._updatingHandles.addPromise((0,b.QZ)(this.update([o])))}}),this._operationHandle=a,o.ready&&o.focus()}async place(e,t){return this.create("mesh",{mode:"click",hasZ:e.hasZ,geometryToPlace:e,...t})}async update(e,t){this.cancel(),await this._waitViewReady();const{layer:o,view:i,state:a}=this;if(!i||"disabled"===a)throw o||this._logMissingLayer(),(0,b.NK)();null!=i.activeTool&&(i.activeTool=null);const r=Array.isArray(e)?e:[e];if(null==e||!r?.length)return void this._logError("sketch:missing-parameter","Missing parameter 'graphics'.");if(r.some(e=>e.layer!==o?(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics missing from the supplied GraphicsLayer."),!0):null==e.geometry&&(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics with an unsupported geometry."),!0)))return;const s=await this._updatingHandles.addPromise(this._setupUpdateOperation(r,t));this.destroyed||null==s||ge(s)||((0,H.Y3)(i,this._internalGraphicsLayer),this._setUpdateOperationHandle(s,t),this.emit("update",{graphics:r,state:"start",aborted:!1,tool:s.tool,toolEventInfo:null,type:"update"}))}async _updateSpatialReference(e){const t=this.view;if(t){e=Array.isArray(e)?e:[e];for(const o of e)null==o.geometry||"mesh"===o.geometry.type||(0,O.aI)(o.geometry.spatialReference,t.spatialReference)||((0,M.canProjectWithoutEngine)(o.geometry.spatialReference,t.spatialReference)||(0,M.isLoaded)()||await(0,M.load)(),o.geometry=(0,M.project)(o.geometry,t.spatialReference))}else this._logMissingView()}undo(){this.canUndo()&&this._operationHandle?.undo()}redo(){this.canRedo()&&this._operationHandle?.redo()}canUndo(){return!!this._operationHandle?.canUndo()}canRedo(){return!!this._operationHandle?.canRedo()}toggleUpdateTool(){this._operationHandle?.toggleTool()}async _getFirstHit(e){const t=this.view;if(!t)return this._logMissingView(),null;if("2d"===t.type){const o=[];t.map.allLayers.forEach(e=>{"vector-tile"!==e.type&&"imagery"!==e.type||o.push(e)});const i=await t.hitTest(e,{exclude:o});return(0,z.zF)(i.results)}const o=[t.map.ground];t.map.allLayers.forEach(e=>{(0,G.Eq)(e.type)&&o.push(e)});const i=await t.hitTest(e,{exclude:o});if(i.results.length>0){const e=i.results[0];if(null!=e&&"graphic"===e.type&&e.graphic&&(!i.ground.mapPoint||t.map.ground.opacity<1||i.ground.distance-(e.distance??0)>-Math.min(3*i.ground.distance,"global"===t.viewingMode?(0,w.tO)(t.renderCoordsHelper.spatialReference).radius/t.renderCoordsHelper.unitInMeters:Number.POSITIVE_INFINITY)))return e}return null}_generateViewHandles(e){return[e.on("immediate-click",async e=>{const t="active"===this.state&&"create"===this._operationHandle?.type;"disabled"!==this.state&&!t&&this.updateOnGraphicClick&&await this._updatingHandles.addPromise(this._handleImmediateClick(e))},Z.o.WIDGET)]}async _handleImmediateClick(e){const t=await e.defer(()=>this._getFirstHit((0,$.ZV)(e)));let o=null;if(null!=t){const i=t.graphic;this.updateGraphics.includes(i)||i.layer===this.layer?(e.stopPropagation(),o=i):"2d"!==this.view?.type||this._isComponentGraphic(i)||"active"!==this.state||this.cancel()}else"active"===this.state&&this.cancel();null==o||this.updateGraphics.includes(o)||await this.update([o],{...this.defaultUpdateOptions,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions}})}async _setupCreateOperation(e,t){const o=this.view;if(!o)return this._logMissingView(),null;const i={hasZ:"3d"===o.type,...this.defaultCreateOptions,...t},a=await this._setupDrawGraphicTool(e,o,i);return null==a?null:(o.tools.add(a),o.activeTool=a,this._setupCreateOperationHandle(a))}async _setupDrawGraphicTool(e,t,o){if("multipoint"===e&&"3d"===t.type)return this._logError("sketch:create","Multipoint geometries are not supported in SceneView."),null;if(!t)return this._logMissingView(),null;const{cursor:i,defaultZ:a,hasZ:r,geometryToPlace:s,graphicProperties:n,mode:p,preserveAspectRatio:l}=o,c=function(e,t){return"freehandPolygon"===t||"freehandPolyline"===t?"freehand":e??("rectangle"===t||"circle"===t?"hybrid":"click")}(p,e),h=function(e){switch(e){case"freehandPolygon":return"polygon";case"freehandPolyline":return"polyline";default:return e}}(e),d=o?.optionsPerTool?.has(e)?o.optionsPerTool.get(e):{},u=d?.preserveAspectRatio??l??"rectangle"!==e,y={centered:"rectangle"!==e&&!("circle"===e&&!u),cursor:i,defaultZ:a,forceUniformSize:u,graphicProperties:{...n,attributes:{...n?.attributes}},geometryToPlace:s,geometryType:h,mode:c,graphicSymbol:this._getGraphicSymbolFromTool(e),hasZ:r,snappingManager:this.snappingManager,snapToScene:!1,view:t,...d};return"2d"===t.type?this._makeDrawGraphicTool2D(y):this._makeDrawGraphicTool3D(y)}async _makeDrawGraphicTool2D(e){const[t,i,a]=await Promise.all([this._requireModule(Promise.all([o.e(26871),o.e(16364),o.e(82103),o.e(48045),o.e(59833),o.e(55903),o.e(41010),o.e(53141),o.e(63404)]).then(o.bind(o,45924))),(0,q.E)(),(0,W.f)()]);return ge(t)||this.destroyed?null:new t.module.DrawGraphicTool2D({...e,activeVertexSymbol:this.activeVertexSymbol,regularVerticesSymbol:this.vertexSymbol,activeLineSymbol:this.activeLineSymbol,activeFillSymbol:pe(e.geometryType)?this.activeFillSymbol:null,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:i,automaticLengthMeasurementUtils:a})}async _makeDrawGraphicTool3D(e){const[t,i,a]=await Promise.all([this._requireModule(Promise.all([o.e(26871),o.e(16364),o.e(82103),o.e(48045),o.e(59833),o.e(86928),o.e(1307),o.e(55903),o.e(32488),o.e(41010),o.e(88577),o.e(53141),o.e(85893),o.e(96999),o.e(24743),o.e(30416)]).then(o.bind(o,24743))),(0,q.E)(),(0,W.f)()]);if(ge(t)||this.destroyed)return null;const{elevationInfo:r}=this.layer;return new t.module.DrawGraphicTool3D({...e,elevationInfo:r,snapToScene:!0,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:i,automaticLengthMeasurementUtils:a})}_setupCreateOperationHandle(e){const t=this.view;if(!t)return this._logMissingView(),null;let o=null;const i=e.forceUniformSize,a=e.centered,s=[t.on("key-down",t=>{if(t.key===N.NE.pan)t.stopPropagation(),t.repeat||(e.enabled=!1);else if(t.key===N.NE.complete)t.stopPropagation(),e.completeCreateOperation();else if(t.key!==N.NE.vertexAdd||t.repeat)t.key===N.NE.undo?(t.stopPropagation(),p.undo()):t.key===N.NE.redo?(t.stopPropagation(),p.redo()):t.key!==N.NE.constraint||"rectangle"!==e.geometryType&&"circle"!==e.geometryType||t.repeat?t.key===N.NE.center&&(t.repeat||(e.centered=!a,t.stopPropagation())):(e.forceUniformSize=!i,t.stopPropagation());else{const o=e.drawOperation.geometryType;"polyline"!==o&&"polygon"!==o&&"multipoint"!==o||(t.stopPropagation(),e.drawOperation.commitStagedVertex())}},Z.o.WIDGET),t.on("key-up",t=>{t.key===N.NE.pan?e.enabled=!0:t.key!==N.NE.constraint||"rectangle"!==e.geometryType&&"circle"!==e.geometryType?t.key===N.NE.center&&(e.centered=a,t.stopPropagation()):(e.forceUniformSize=i,t.stopPropagation())},Z.o.WIDGET),e.on("vertex-add",t=>{switch(o=null==o?"start":"active",t.operation){case"apply":this.emit("create",{graphic:e.graphic,state:o,tool:this.activeTool,toolEventInfo:t,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[e.graphic],tool:e.geometryType});break;case"redo":this._emitRedoEvent({graphics:[e.graphic],tool:e.geometryType})}}),e.on("cursor-update",t=>{e.drawOperation.numCommittedVertices>0&&this.emit("create",{graphic:e.graphic,state:"active",tool:this.activeTool,toolEventInfo:{coordinates:t.vertices[0].coordinates,type:"cursor-update"},type:"create"})}),e.on("vertex-remove",t=>{switch(t.operation){case"apply":this.emit("create",{graphic:e.graphic,state:"active",tool:this.activeTool,toolEventInfo:t,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[e.graphic],tool:e.geometryType});break;case"redo":this._emitRedoEvent({graphics:[e.graphic],tool:e.geometryType})}}),e.on("complete",e=>{this._set("createGraphic",e.graphic),o="complete",e.aborted?p&&p.cancel():p&&p.complete()}),(0,n.wB)(()=>this._getGraphicSymbolFromTool(e.geometryType),t=>{e.graphicSymbol=t})],p=new J({activeComponent:e,tool:e.geometryType,type:"create",onEnd:()=>{(0,r.ei)(s),t.tools?.remove(e)},undo:()=>{e.canUndo&&e.undo()},redo:()=>{e.canRedo&&e.redo()},canUndo:()=>e.canUndo,canRedo:()=>e.canRedo});return p}_getGraphicSymbolFromTool(e){switch(e){case"point":case"multipoint":return this.pointSymbol;case"polyline":case"freehandPolyline":return this.polylineSymbol;case"circle":case"rectangle":case"polygon":case"freehandPolygon":return this.polygonSymbol;case"mesh":return this.meshSymbol}}async _setupUpdateOperation(e,t){const{layer:o,view:i}=this;if(!i)return this._logMissingView(),null;const a={...this.defaultUpdateOptions,...t,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions,...t?.reshapeOptions},highlightOptions:{...this.defaultUpdateOptions.highlightOptions,...t?.highlightOptions}};let r=a.tool??ae.tool;for(const s of e)o.remove(s),o.add(s);if("3d"===i.type){if(0===e.length)return null;switch(r){case"move":return this._setupMove3DOperation(e,a,i,r);case"reshape":return e.length>1?(this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null):this._setupReshape3DOperation(e[0],a,i);case"transform":return this._setupGraphicTransform3DOperation(e,a,i)}}switch(r){case"move":return this._setupMove2DOperation(e,a,i);case"reshape":return e.length>1?(this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null):this._setupTransformOrReshape2DOperation(e,r,a,i);case"transform":if(1===e.length){const t=e[0].geometry?.type;"point"!==t&&"multipoint"!==t||(r="reshape")}return this._setupTransformOrReshape2DOperation(e,r,a,i)}}async _setupMove3DOperation(e,t,i,a){let s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const[n,p]=await Promise.all([this._requireModule(Promise.all([o.e(26871),o.e(16364),o.e(82103),o.e(48045),o.e(59833),o.e(86928),o.e(1307),o.e(55903),o.e(32488),o.e(41010),o.e(88577),o.e(53141),o.e(85893),o.e(96999),o.e(24743),o.e(30416)]).then(o.bind(o,24743))),(0,W.f)()]);if(ge(n))return n;const{ManipulatedObject3DGraphic:l,MoveTool3D:c}=n.module,h=new Map,d=()=>{h.forEach(e=>e.destroy()),h.clear()};for(const o of e){const e=new l({view:i,graphic:o}),t=(0,D.Y)(e);if(t!==C.d.SUPPORTED)return d(),this._logError("sketch:move",`Move operation not supported for provided graphic(s) (${(0,C.c)(t)}).`),null;h.set(o,e)}const u=new c({view:i,enableZ:t.enableZ,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,autoLengthMeasurementUtils:p});i.tools.add(u),u.objects.addMany(Array.from(h.values())),s||this.updateGraphics.addMany(e);const y=[],g=new ee({activeComponent:u,tool:a,type:"update",onEnd:()=>{(0,r.ei)(y),ye(i,u),d()},undo:()=>{de(this.view,u),le(g,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:a})},redo:()=>{ce(g,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:a})},addToSelection:e=>{this.updateGraphics.push(e);const t=new l({view:i,graphic:e});h.set(e,t),u.objects.push(t),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:e=>{const t=this.updateGraphics.indexOf(e);if(g.history.undo.forEach(e=>e.updates.splice(t,1)),g.history.redo.forEach(e=>e.updates.splice(t,1)),this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),0===this.updateGraphics.length)return void g.complete();const o=h.get(e);o&&(u.objects.remove(o),o.destroy(),h.delete(e))},toggleTool:async()=>{if(1!==this.updateGraphics.length||!1===t.toggleToolOnClick)return;if("transform"!==a)return;const e=this.updateGraphics.at(0),o=await this._setupReshape3DOperation(e,t,i,!0);o&&!ge(o)&&(g.onEnd(),g.destroy(),this._setUpdateOperationHandle(o,t))}});return y.push(...this._getHandlesForComponent(g,t),i.on("immediate-click",e=>this._getCommonUpdateOperationClickHandlers(g,e,t),Z.o.WIDGET),i.on("key-down",e=>{this._getCommonUpdateOperationKeyDownHandlers(g,e)},Z.o.WIDGET)),g}_setupGraphicTransform3DOperation(e,t,o){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(1===e.length&&function(e){if("graphics"!==e.layer?.type)return C.d.GRAPHICS_LAYER_MISSING;if(null==e.geometry)return C.d.GEOMETRY_MISSING;switch(e.geometry.type){case"point":break;case"polygon":case"polyline":case"multipoint":case"extent":case"mesh":return C.d.SUPPORTED;default:return C.d.GEOMETRY_TYPE_UNSUPPORTED}const t=null!=e.symbol&&"point-3d"===e.symbol.type&&e.symbol.symbolLayers;return t&&t.some(e=>"object"===e.type)?"on-the-ground"!==(0,I.ky)(e)&&(0,I.NN)(e)?C.d.ELEVATION_MODE_UNSUPPORTED:C.d.SUPPORTED:C.d.SYMBOL_TYPE_UNSUPPORTED}(e[0])===C.d.SUPPORTED){const a=e[0],r=a.geometry;if(null!=r&&("point"===r.type||"mesh"===r.type))return this._setupPointTransform3DOperation(a,t,o);if(null!=r&&("polygon"===r.type||"polyline"===r.type))return this._setupPolyTransform3DOperation(a,t,o,i)}return this._setupMove3DOperation(e,t,o,"transform",i)}async _setupPointTransform3DOperation(e,t,i){const a="transform",{enableRotation:s,enableScaling:n,enableZ:p}=t,l=await this._requireModule(Promise.all([o.e(26871),o.e(16364),o.e(82103),o.e(48045),o.e(59833),o.e(86928),o.e(1307),o.e(55903),o.e(32488),o.e(41010),o.e(88577),o.e(53141),o.e(85893),o.e(96999),o.e(24743),o.e(30416)]).then(o.bind(o,24743)));if(ge(l))return l;const{TransformTool3D:c,ManipulatedObject3DGraphic:h}=l.module,d=new h({graphic:e,view:i}),u=new c({object:d,view:i,enableRotation:s,enableScaling:n,enableZ:p,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions});i.tools.add(u),this.updateGraphics.add(e);const y=[],g=new ee({activeComponent:u,tool:a,type:"update",onEnd:()=>{(0,r.ei)(y),ye(i,u),d.destroy()},undo:()=>{de(this.view,u),le(g,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:a})},redo:()=>{ce(g,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:a})},addToSelection:async e=>{this.updateGraphics.add(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"}),g.onEnd(),g.destroy();const o=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,i,"transform",!0);ge(o)||this._setUpdateOperationHandle(o,t)},removeFromSelection:e=>{this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),g.complete()},toggleTool:()=>{}});return y.push(...this._getHandlesForComponent(g,t),i.on("immediate-click",e=>this._getCommonUpdateOperationClickHandlers(g,e,t),Z.o.WIDGET),i.on("key-down",e=>{this._getCommonUpdateOperationKeyDownHandlers(g,e)},Z.o.WIDGET)),g}async _setupPolyTransform3DOperation(e,t,i){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const s="transform",{enableRotation:n,enableScaling:p,enableZ:l,preserveAspectRatio:c}=t,[h,d]=await Promise.all([this._requireModule(Promise.all([o.e(26871),o.e(16364),o.e(82103),o.e(48045),o.e(59833),o.e(86928),o.e(1307),o.e(55903),o.e(32488),o.e(41010),o.e(88577),o.e(53141),o.e(85893),o.e(96999),o.e(24743),o.e(30416)]).then(o.bind(o,24743))),(0,W.f)()]);if(ge(h))return h;const{ManipulatedObject3DGraphic:u,ExtentTransformTool:y}=h.module,g=this.view?.inputManager?.isModifierKeyDown(N.NE.constraint),v=new u({view:i,graphic:e}),m=new y({object:v,view:i,enableRotation:n,enableScaling:p,enableZ:l,preserveAspectRatio:!!c!=!!g,sketchOptions:this.sketchOptions,automaticLengthMeasurementUtils:d});i.tools.add(m),a||this.updateGraphics.add(e);const _=[],f=new ee({activeComponent:m,tool:s,type:"update",onEnd:()=>{(0,r.ei)(_),ye(i,m),v.destroy()},canUndo:()=>!m.destroyed&&m.canUndo,undo:()=>{m.destroyed||(m.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:s}))},canRedo:()=>!m.destroyed&&m.canRedo,redo:()=>{m.destroyed||(m.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:s}))},addToSelection:async e=>{this.updateGraphics.add(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"}),f.onEnd(),f.destroy();const o=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,i,"transform",!0);ge(o)||this._setUpdateOperationHandle(o,t)},removeFromSelection:e=>{this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),f.complete()},toggleTool:async()=>{if(1!==this.updateGraphics.length||!1===t.toggleToolOnClick)return;const o=await this._setupReshape3DOperation(e,t,i,!0);o&&!ge(o)&&(f.onEnd(),f.destroy(),this._setUpdateOperationHandle(o,t))}});return _.push(...this._getHandlesForComponent(f,t),i.on("immediate-click",e=>this._getCommonUpdateOperationClickHandlers(f,e,t),Z.o.WIDGET),i.on("key-down",e=>this._getCommonUpdateOperationKeyDownHandlers(f,e),Z.o.WIDGET),i.on("key-down",e=>{e.key!==N.NE.constraint||e.repeat||(m.preserveAspectRatio=!m.preserveAspectRatio,e.stopPropagation())},Z.o.WIDGET),i.on("key-up",e=>{e.key===N.NE.constraint&&(m.preserveAspectRatio=!m.preserveAspectRatio,e.stopPropagation())},Z.o.WIDGET)),f}async _setupMove2DOperation(e,t,o){const i="move";this.updateGraphics.addMany(e),await this._updatingHandles.addPromise(this._updateSpatialReference(e));const a=await this._getGraphicMover(e,t,o);if(ge(a))return a;const s=new ee({activeComponent:a,tool:i,type:"update",onEnd:()=>{this._displayDefaultCursor(),(0,r.ei)(l),(0,r.ei)(p),a.destroy(),this._internalGraphicsLayer?.removeMany([...this.updateGraphics.toArray()])},undo:()=>{const e=this.updateGraphics.toArray();le(s,e),s.refreshComponent(),this._emitUndoEvent({graphics:e,tool:i})},redo:()=>{const e=this.updateGraphics.toArray();ce(s,e),s.refreshComponent(),this._emitRedoEvent({graphics:e,tool:i})},addToSelection:async e=>{await this._updatingHandles.addPromise(this._updateSpatialReference(e)),this.updateGraphics.push(e),a.graphics=this.updateGraphics.toArray(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:e=>{const t=this.updateGraphics.indexOf(e);s.history.undo.forEach(e=>e.updates.splice(t,1)),s.history.redo.forEach(e=>e.updates.splice(t,1)),this.updateGraphics.remove(e);const o=this.updateGraphics.toArray();this.emit("update",{graphics:o,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),0!==this.updateGraphics.length?a.graphics=o:s.complete()}});let n=!1;const p=[o.on("immediate-click",e=>this._getCommonUpdateOperationClickHandlers(s,e,t),Z.o.WIDGET),o.on("key-down",e=>{this._getCommonUpdateOperationKeyDownHandlers(s,e),e.key!==N.NE.constraint||e.repeat||(n=!0,a.enableMoveAllGraphics=!a.enableMoveAllGraphics)},Z.o.WIDGET),o.on("key-up",e=>{e.key===N.NE.constraint&&n&&(n=!1,a.enableMoveAllGraphics=!a.enableMoveAllGraphics)},Z.o.WIDGET)],l=this._getHandlesForComponent(s,t);return s}async _setupReshape3DOperation(e,t,i){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const s="reshape",[n,p,l]=await Promise.all([this._requireModule(Promise.all([o.e(26871),o.e(16364),o.e(82103),o.e(48045),o.e(59833),o.e(86928),o.e(1307),o.e(55903),o.e(32488),o.e(41010),o.e(88577),o.e(53141),o.e(85893),o.e(96999),o.e(24743),o.e(30416)]).then(o.bind(o,24743))),(0,q.E)(),(0,W.f)()]);if(ge(n))return n;const{ManipulatedObject3DGraphic:c,ReshapeTool3D:h}=n.module,d=new c({view:i,graphic:e}),u=U(d);if(u!==C.d.SUPPORTED)return d.destroy(),this._logError("sketch:reshape",`Reshape operation not supported for provided graphic(s) (${(0,C.c)(u)}).`),null;const y=t.reshapeOptions,g=new h({view:i,object:d,enableZVertex:t.enableZ&&"move"===y?.vertexOperation,enableZShape:t.enableZ&&"move"===y?.shapeOperation,enableMoveObject:"move"===y?.shapeOperation||"move-xy"===y?.shapeOperation,enableMidpoints:"split"===y?.edgeOperation,enableEdgeOffset:"offset"===y?.edgeOperation,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:p,automaticLengthMeasurementUtils:l});i.tools.add(g),a||this.updateGraphics.add(d.graphic);const v=[],m=new ee({activeComponent:g,tool:s,type:"update",onEnd:()=>{(0,r.ei)(v),ye(i,g),d.destroy()},canUndo:()=>!g.destroyed&&g.canUndo,undo:()=>{g.destroyed||(g.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:s}))},canRedo:()=>!g.destroyed&&g.canRedo,redo:()=>{g.destroyed||(g.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:s}))},addToSelection:async e=>{this.updateGraphics.add(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"}),m.onEnd(),m.destroy();const o=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,i,"transform",!0);ge(o)||this._setUpdateOperationHandle(o,t)},removeFromSelection:e=>{this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),m.complete()},toggleTool:async()=>{if(!1===t.toggleToolOnClick)return;m.onEnd(),m.destroy();const e=await this._setupGraphicTransform3DOperation(this.updateGraphics.toArray(),t,i,!0);ge(e)||this._setUpdateOperationHandle(e,t)}});return v.push(...this._getHandlesForComponent(m,t),i.on("immediate-click",e=>this._getCommonUpdateOperationClickHandlers(m,e,t),Z.o.WIDGET),i.on("key-down",e=>{this._getCommonUpdateOperationKeyDownHandlers(m,e)},Z.o.WIDGET)),m}async _setupTransformOrReshape2DOperation(e,t,o,i){this.updateGraphics.addMany(e),await this._updatingHandles.addPromise(this._updateSpatialReference(e));const a="transform"===t?await this._getBox(e,o,i):await this._getReshape(e,o,i);if(ge(a))return a;const s=new ee({activeComponent:a,type:"update",onEnd:()=>{(0,r.ei)(p),(0,r.ei)(n),s.activeComponent&&!s.activeComponent.destroyed&&s.activeComponent.destroy(),this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray())},undo:()=>{le(s,this.updateGraphics.toArray()),s.refreshComponent(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:s.tool})},redo:()=>{ce(s,this.updateGraphics.toArray()),s.refreshComponent(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:s.tool})},addToSelection:async e=>{let t=s.activeComponent;if("reshape"===t?.type){const t=[...this.updateGraphics,e];this.updateGraphics.removeAll(),s.onEnd(),s.destroy();const a=await this._setupTransformOrReshape2DOperation(t,"transform",o,i);if(ge(a))return;this._setUpdateOperationHandle(a,o)}else this.updateGraphics.add(e),t.graphics=this.updateGraphics.toArray(),t.refresh(),s.resetHistory();this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:async e=>{const t=this.updateGraphics.indexOf(e);s.history.undo.forEach(e=>e.updates.splice(t,1)),s.history.redo.forEach(e=>e.updates.splice(t,1)),this.updateGraphics.remove(e);const o=this.updateGraphics.toArray();if(0===o.length)s.complete();else{const e=o[0].geometry;1!==o.length||null==e||"point"!==e.type&&"multipoint"!==e.type?s.activeComponent.graphics=o:s.toggleTool()}this.emit("update",{graphics:o,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"})},toggleTool:async()=>{if(this.updateGraphics.length>1)return;const e=this.updateGraphics.at(0),t=e.geometry;if(null!=t&&("reshape"===s.tool&&("point"===t.type||"multipoint"===t.type)||"transform"===s.tool&&"extent"===t.type))return;let a=null;"transform"===s.tool?a=await this._getReshape([e],o,i):"reshape"===s.tool&&(a=await this._getBox([e],o,i)),ge(a)||(s.activeComponent?.destroy(),s.activeComponent=a,s.activeComponent&&((0,r.ei)(p),p=this._getHandlesForComponent(s,o)))}}),n=[i.on("immediate-click",e=>this._getCommonUpdateOperationClickHandlers(s,e,o),Z.o.WIDGET),i.on("key-down",e=>{if(this._getCommonUpdateOperationKeyDownHandlers(s,e),e.key===N.NE.constraint&&!e.repeat&&s){const e=s.activeComponent;e&&"box"===e.type&&(e.preserveAspectRatio=!e.preserveAspectRatio)}},Z.o.WIDGET),i.on("key-up",e=>{if(e.key===N.NE.constraint&&s){const e=s.activeComponent;e&&"box"===e.type&&(e.preserveAspectRatio=!e.preserveAspectRatio)}},Z.o.WIDGET)];let p=this._getHandlesForComponent(s,o);return s}async _getGraphicMover(e,t,i){const{enableMoveAllGraphics:a,highlightOptions:r}=t,s=await this._requireModule(Promise.all([o.e(61472),o.e(91720)]).then(o.bind(o,61472)));return ge(s)?s:new s.module.default({enableMoveAllGraphics:a,highlightName:r?.name,highlightsEnabled:!!r?.enabled,indicatorsEnabled:!1,graphics:e,view:i,callbacks:{onGraphicMoveStart:e=>{let{dx:t,dy:o,graphic:i}=e;this._displayGrabbingCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:t,dy:o,mover:i,type:"move-start"},type:"update"})},onGraphicMove:e=>{let{dx:t,dy:o,graphic:i}=e;return this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:t,dy:o,mover:i,type:"move"},type:"update"})},onGraphicMoveStop:e=>{let{dx:t,dy:o,graphic:i}=e;this._displayPointerCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:t,dy:o,mover:i,type:"move-stop"},type:"update"})},onGraphicPointerOver:()=>this._displayMoveCursor(),onGraphicPointerOut:()=>this._displayDefaultCursor()}})}async _getBox(e,t,i){const{enableRotation:a,enableScaling:r,highlightOptions:s,preserveAspectRatio:n}=t,[p,l]=await Promise.all([this._requireModule(Promise.all([o.e(55903),o.e(61472),o.e(20819)]).then(o.bind(o,20819))),(0,W.f)()]);if(ge(p))return p;const c=this.view?.inputManager?.isModifierKeyDown(N.NE.constraint);return new p.module.default({graphics:e,enableRotation:a,enableScaling:r,highlightName:s?.name,highlightsEnabled:!!s?.enabled,preserveAspectRatio:!!n!=!!c,layer:this._internalGraphicsLayer,view:i,sketchOptions:this.sketchOptions,automaticLengthMeasurementUtils:l,callbacks:{onMoveStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onMove:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onMoveStop:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onScaleStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onScale:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onScaleStop:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onRotateStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onRotate:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onRotateStop:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"})}})}async _getReshape(e,t,i){const{highlightOptions:a,reshapeOptions:r}=t,s="split"===r?.edgeOperation,n="move"===r?.shapeOperation,[p,l,c]=await Promise.all([this._requireModule(Promise.all([o.e(59833),o.e(55903),o.e(61472),o.e(6552)]).then(o.bind(o,6552))),(0,q.E)(),(0,W.f)()]);return ge(p)?p:new p.module.default({enableMidpoints:s,enableMovement:n,graphic:e[0],highlightName:a?.name,highlightsEnabled:!!a?.enabled,layer:this._internalGraphicsLayer,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:l,automaticLengthMeasurementUtils:c,view:i,callbacks:{onReshapeStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onReshape:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onReshapeStop:e=>{let{mover:t,type:o}=e;return this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:t,type:o},type:"update"})},onMoveStart:e=>{let{dx:t,dy:o,mover:i,type:a}=e;return this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:t,dy:o,mover:i,type:a},type:"update"})},onMove:e=>{let{dx:t,dy:o,mover:i,type:a}=e;return this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:t,dy:o,mover:i,type:a},type:"update"})},onMoveStop:e=>{let{dx:t,dy:o,mover:i,type:a}=e;return this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:t,dy:o,mover:i,type:a},type:"update"})},onVertexAdd:e=>{let{added:t,type:o,vertices:i}=e;const a=t.map(e=>(0,E.$K)(e.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:a,vertices:i,type:o},type:"update"})},onVertexRemove:e=>{let{removed:t,type:o,vertices:i}=e;const a=t.map(e=>(0,E.$K)(e.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{removed:a,vertices:i,type:o},type:"update"})}}})}_getHandlesForComponent(e,t){const o=e.activeComponent;if(!o)return[];switch(o.type){case"graphic-mover":return[o.on("graphic-click",o=>{let{graphic:i,viewEvent:a}=o;a.native?.shiftKey&&t.multipleSelectionEnabled&&(a.stopPropagation(),e.removeFromSelection(i))}),o.on("graphic-move-start",t=>e.addToHistory(ue(t.allGraphics)))];case"box":return[o.on("graphic-click",o=>this._onTransformOrReshape2DGraphicClick(e,t,o)),o.on("move-start",t=>e.addToHistory(ue(t.graphics))),o.on("rotate-start",t=>e.addToHistory(ue(t.graphics))),o.on("scale-start",t=>e.addToHistory(ue(t.graphics)))];case"reshape":return[o.on("graphic-click",o=>this._onTransformOrReshape2DGraphicClick(e,t,o)),o.on("move-start",t=>e.addToHistory(ue([t.mover]))),o.on("reshape-start",t=>e.addToHistory(ue([t.graphic]))),o.on("vertex-add",t=>e.addToHistory(ue([t.oldGraphic]))),o.on("vertex-remove",t=>e.addToHistory(ue([t.oldGraphic])))];case"move-3d":return[o.events.on("record-undo",t=>{let{updates:o}=t;e.addToHistory({updates:o})}),o.events.on("move-start",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:e.objects.length>0?e.objects[0].graphic:null,type:"move-start"},type:"update"})}),o.events.on("move",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e.dx,dy:e.dy,mover:e.objects.length>0?e.objects[0].graphic:null,type:"move"},type:"update"})}),o.events.on("move-stop",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:e.objects.length>0?e.objects[0].graphic:null,type:"move-stop"},type:"update"})}),o.events.on("immediate-click",o=>{o.shiftKey?this._toggleSelection([o.object.graphic],e,t):e.toggleTool()})];case"transform-3d":return[o.events.on("record-undo",t=>{let{updates:o}=t;e.addToHistory({updates:o})}),o.events.on("translate-start",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,dx:e.dxScreen,dy:e.dyScreen,type:"move-start"},type:"update"})}),o.events.on("translate-stop",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,dx:e.dxScreen,dy:e.dyScreen,type:"move-stop"},type:"update"})}),o.events.on("rotate-start",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,angle:e.angle,type:"rotate-start"},type:"update"})}),o.events.on("rotate-stop",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,angle:e.angle,type:"rotate-stop"},type:"update"})}),o.events.on("scale-start",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,xScale:e.xScale,yScale:e.yScale,type:"scale-start"},type:"update"})}),o.events.on("scale-stop",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,xScale:e.xScale,yScale:e.yScale,type:"scale-stop"},type:"update"})}),o.events.on("translate",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,dx:e.dxScreen,dy:e.dyScreen,type:"move"},type:"update"})}),o.events.on("rotate",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,angle:e.angle,type:"rotate"},type:"update"})}),o.events.on("scale",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,xScale:e.xScale,yScale:e.yScale,type:"scale"},type:"update"})}),o.events.on("immediate-click",o=>{o.shiftKey?this._toggleSelection([o.object.graphic],e,t):e.toggleTool()})];case"reshape-3d":return[o.events.on("reshape",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e,mover:e.object.graphic},type:"update"})}),o.events.on("move",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e,mover:e.object.graphic},type:"update"})}),o.events.on("vertex-add",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:e,type:"update"})}),o.events.on("vertex-remove",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:e,type:"update"})}),o.events.on("immediate-click",o=>{o.shiftKey?this._toggleSelection([o.object.graphic],e,t):e.toggleTool()})]}}_onTransformOrReshape2DGraphicClick(e,t,o){const{graphic:i,viewEvent:a}=o;return a.native?.shiftKey&&i.layer===this.layer?(a.stopPropagation(),e.removeFromSelection(i)):t.toggleToolOnClick?(a.stopPropagation(),e.toggleTool()):void 0}_setUpdateOperationHandle(e,t){this._operationHandle=e;const o=this.view?.map;this._disablePopup(t);e.on("complete",()=>{if(e===this._operationHandle){const i=this.updateGraphics.toArray(),a=this._operationHandle.tool;this._operationHandle.destroy(),this._operationHandle=null,this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray()),this.updateGraphics.removeAll(),o&&o.remove(this._internalGraphicsLayer),this._restorePopup(t),this.emit("update",{graphics:i,state:"complete",aborted:e.cancelled,tool:a,toolEventInfo:null,type:"update"})}})}async _getCommonUpdateOperationClickHandlers(e,t,o){const i=(0,$.ZV)(t),a=await t.defer(()=>this._getFirstHit(i));null!=a&&(t.native.shiftKey&&this._toggleSelection([a.graphic],e,o)||this.updateGraphics.includes(a.graphic))?t.stopPropagation():e.complete()}_toggleSelection(e,t,o){const i=!!o.multipleSelectionEnabled;return e.some(e=>null!=e&&!(!i||e.layer!==this.layer)&&(this.updateGraphics.includes(e)?t.removeFromSelection(e):t.addToSelection(e),!0))}_getCommonUpdateOperationKeyDownHandlers(e,t){if(!e)return;const o=t.key;o===N.NE.undo&&e.canUndo()?(t.stopPropagation(),e.undo()):o===N.NE.redo&&e.canRedo()?(t.stopPropagation(),e.redo()):o===N.NE.cancel?(t.stopPropagation(),e.cancel()):this.allowDeleteKey&&N.NE.delete.includes(o)&&this._onDeleteKey(t)}_onDeleteKey(e){if(!this._operationHandle||"update"!==this._operationHandle.type)return;const t=this.activeComponent,o=this.updateGraphics.toArray();null!=t&&("reshape"!==t.type||1===o.length&&"point"===o[0].geometry?.type)&&(e.stopPropagation(),this.delete())}_removeDefaultLayer(){this._internalGraphicsLayer&&(this.view?.map?.remove(this._internalGraphicsLayer),this._internalGraphicsLayer=(0,s.pR)(this._internalGraphicsLayer))}_isComponentGraphic(e){const{activeComponent:t}=this;return!(!e||null==t)&&(e.attributes?.esriSketchTool||"draw-2d"===t.type&&t.graphic===e||("box"===t.type||"reshape"===t.type)&&t.isUIGraphic(e))}_displayPointerCursor(){this.view?.container&&"pointer"!==this.view.cursor&&(this.view.cursor="pointer")}_displayGrabbingCursor(){this.view?.container&&"grabbing"!==this.view.cursor&&(this.view.cursor="grabbing")}_displayMoveCursor(){this.view?.container&&"move"!==this.view.cursor&&(this.view.cursor="move")}_displayDefaultCursor(){this.view?.container&&null!==this.view.cursor&&(this.view.cursor=null)}_logError(e,t,o){l.A.getLogger(this).error(new _.A(e,t,o))}async _requireModule(e){const t=new AbortController;this._moduleLoaderAbortController=t;const o=await e;return this._moduleLoaderAbortController!==t||t.signal.aborted?{requireError:"aborted"}:{module:o}}_emitUndoEvent(e){this.emit("undo",{...e,type:"undo"})}_emitRedoEvent(e){this.emit("redo",{...e,type:"redo"})}_emitDeleteEvent(e){this.emit("delete",{...e,type:"delete"})}get test(){}wait(){return(0,n.C_)(()=>!this.updating)}_disablePopupEnabled(e){return"3d"!==this.view?.type||this.updateOnGraphicClick||(e?.toggleToolOnClick??!1)}_disablePopup(e){this._disablePopupEnabled(e)&&this.view&&null==this._originalPopupEnabled&&(this._originalPopupEnabled=this.view.popupEnabled,this.view.popupEnabled=!1)}_restorePopup(e){this._disablePopupEnabled(e)&&this.view&&null!=this._originalPopupEnabled&&(this.view.popupEnabled=this._originalPopupEnabled,this._originalPopupEnabled=null)}async _waitViewReady(){const e=this.view;e?((0,s.DC)(this._viewReadyAbortController),this._viewReadyAbortController=new AbortController,await(0,b.qr)((0,n.C_)(()=>e?.ready),this._viewReadyAbortController.signal)):this._logMissingView()}_logMissingView(){this._logError("sketch:missing-property",ne("view"))}_logMissingLayer(){this._logError(se,ne("layer"))}};(0,i._)([(0,p.MZ)()],re.prototype,"_defaultSnappingManager",void 0),(0,i._)([(0,p.MZ)()],re.prototype,"updating",null),(0,i._)([(0,p.MZ)({readOnly:!0})],re.prototype,"_updatingHandles",void 0),(0,i._)([(0,p.MZ)()],re.prototype,"_operationHandle",void 0),(0,i._)([(0,p.MZ)({readOnly:!0})],re.prototype,"activeTool",null),(0,i._)([(0,p.MZ)({readOnly:!0})],re.prototype,"activeCreateToolDrawMode",null),(0,i._)([(0,p.MZ)()],re.prototype,"activeTooltip",null),(0,i._)([(0,p.MZ)({types:R.Es})],re.prototype,"activeFillSymbol",void 0),(0,i._)([(0,p.MZ)()],re.prototype,"activeLineSymbol",void 0),(0,i._)([(0,p.MZ)()],re.prototype,"activeVertexSymbol",void 0),(0,i._)([(0,p.MZ)()],re.prototype,"allowDeleteKey",void 0),(0,i._)([(0,p.MZ)({readOnly:!0})],re.prototype,"createGraphic",null),(0,i._)([(0,p.MZ)()],re.prototype,"defaultCreateOptions",null),(0,i._)([(0,p.MZ)()],re.prototype,"defaultUpdateOptions",null),(0,i._)([(0,p.MZ)({type:L.A,nonNullable:!0})],re.prototype,"labelOptions",null),(0,i._)([(0,p.MZ)()],re.prototype,"layer",void 0),(0,i._)([(0,p.MZ)({types:R.Es})],re.prototype,"pointSymbol",void 0),(0,i._)([(0,p.MZ)({types:R.Es})],re.prototype,"polygonSymbol",void 0),(0,i._)([(0,p.MZ)({types:R.Es})],re.prototype,"polylineSymbol",void 0),(0,i._)([(0,p.MZ)()],re.prototype,"meshSymbol",void 0),(0,i._)([(0,p.MZ)({type:Y.A,nonNullable:!0})],re.prototype,"snappingOptions",null),(0,i._)([(0,p.MZ)()],re.prototype,"snappingManager",null),(0,i._)([(0,p.MZ)({readOnly:!0})],re.prototype,"state",null),(0,i._)([(0,p.MZ)({type:B.A,nonNullable:!0})],re.prototype,"tooltipOptions",null),(0,i._)([(0,p.MZ)({readOnly:!0})],re.prototype,"updateGraphics",void 0),(0,i._)([(0,p.MZ)()],re.prototype,"updateOnGraphicClick",void 0),(0,i._)([(0,p.MZ)()],re.prototype,"creationMode",void 0),(0,i._)([(0,p.MZ)({type:V.A,nonNullable:!0})],re.prototype,"valueOptions",null),(0,i._)([(0,p.MZ)({types:R.Es})],re.prototype,"vertexSymbol",void 0),(0,i._)([(0,p.MZ)({value:null})],re.prototype,"view",null),(0,i._)([(0,p.MZ)({constructOnly:!0,type:x.A})],re.prototype,"sketchOptions",void 0),re=(0,i._)([(0,c.$)("esri.widgets.Sketch.SketchViewModel")],re);const se="sketch:missing-property",ne=e=>`Property '${e}' is missing on SketchViewModel.`;function pe(e){return"polygon"===e||"rectangle"===e||"circle"===e}function le(e,t){he("undo",e.history.undo,e.history.redo,t)}function ce(e,t){he("redo",e.history.redo,e.history.undo,t)}function he(e,t,o,i){const a=t.pop();if(!a)return;const r=a.updates,s=[];i.forEach((t,o)=>{const i=r[o];null!=i&&("geometry"in i&&null!=i.geometry&&(s.push({geometry:t.geometry}),t.geometry=i.geometry),"symbol"in i&&null!=i.symbol&&(s.push({symbol:t.symbol}),t.symbol=i.symbol),"undo"in i&&(s.push(i),i[e](t)))}),o.push({updates:s})}function de(e,t){null!=e&&t.hasGrabbedManipulators&&(e.activeTool=null)}function ue(e){return{updates:e.map(e=>{let{geometry:t}=e;return"mesh"===t?.type?{geometry:t.cloneShallow()}:{geometry:t}})}}function ye(e,t){e.tools?.remove(t),t.destroyed||t.destroy()}function ge(e){return"requireError"in e&&"aborted"===e.requireError}function ve(e,t){e.networkFeature=t}function me(e){return e.networkFeature}function _e(e){return"point"===e?.type||"polyline"===e?.type||"polygon"===e?.type}let fe=class extends a.A{constructor(e){super(e),this._createMode=null,this._graphicsLayer=new d.A({internal:!0,listMode:"hide",title:"Banana"}),this._updatingHandles=new h.U,this.enabled=!0,this._handleSketchViewModelEvents=async e=>{switch(e.type){case"update":switch(e.state){case"active":case"complete":for(const t of e.graphics)me(t).geometry=_e(t.geometry)?t.geometry.clone():null}break;case"undo":case"redo":break;case"delete":for(const t of e.graphics){const e=me(t);this._removeNetworkFeature(e)}break;case"create":if(e.graphic&&"complete"===e.state&&this._createMode){const t=e.graphic.geometry?.clone(),o=e.graphic.symbol?.clone();if(!t)break;switch(this._createMode){case"stop":{if("point"!==t.type)break;const{stops:o}=this.layer;if(o.length>0&&o.every(e=>{let{geometry:t}=e;return!t})){o.at(0).geometry=t;break}if(o.length>1&&o.filter((e,t)=>0!==t).every(e=>{let{geometry:t}=e;return!t})){o.at(1).geometry=t;break}const i=new v.A({geometry:t});o.add(i),ve(e.graphic,i);break}case"point-barrier":{if("point"!==t.type)break;const i=new u.A({geometry:t,symbol:o});this.layer.pointBarriers.add(i),ve(e.graphic,i);break}case"polyline-barrier":{if("polyline"!==t.type)break;const i=new g.A({geometry:t,symbol:o});this.layer.polylineBarriers.add(i),ve(e.graphic,i);break}case"polygon-barrier":{if("polygon"!==t.type)break;const i=new y.A({geometry:t,symbol:o});this.layer.polygonBarriers.add(i),ve(e.graphic,i);break}}}}(await this.view.whenLayerView(this.layer)).emit(e.type,"create"===e.type?function(e){const t=me(e.graphic);return{...e,networkFeature:t}}(e):function(e){const t=e.graphics.map(e=>me(e));return{...e,networkFeatures:t}}(e))}}initialize(){this._sketchViewModel=new re({layer:this._graphicsLayer,view:this.view}),this.addHandles([(0,n.wB)(()=>this.enabled,e=>{e?this._activate():this._deactivate()},n.Vh),(0,n.wB)(()=>{const{stops:e,pointBarriers:t,polylineBarriers:o,polygonBarriers:i}=this.layer;return{stops:e,pointBarriers:t,polylineBarriers:o,polygonBarriers:i}},()=>{this.enabled&&this._loadClonedGraphics()}),this._sketchViewModel.on(["create","delete","redo","undo","update"],this._handleSketchViewModelEvents),(0,r.DQ)(this._updatingHandles)])}destroy(){this.view.map.remove(this._graphicsLayer),this._graphicsLayer.removeAll(),this._graphicsLayer=(0,s.pR)(this._graphicsLayer),this._sketchViewModel=(0,s.pR)(this._sketchViewModel)}get selectedNetworkFeatures(){return this._sketchViewModel.updateGraphics.map(e=>me(e))}get updating(){return this._updatingHandles.updating}create(e){switch(this._createMode=e,e){case"stop":this.layer.defaultSymbols.stops?.unlocated&&(this._sketchViewModel.pointSymbol=this.layer.defaultSymbols.stops.unlocated.clone());break;case"point-barrier":this.layer.defaultSymbols.pointBarriers&&(this._sketchViewModel.pointSymbol=this.layer.defaultSymbols.pointBarriers.clone());break;case"polyline-barrier":this.layer.defaultSymbols.polylineBarriers&&(this._sketchViewModel.polylineSymbol=this.layer.defaultSymbols.polylineBarriers.clone());break;case"polygon-barrier":this.layer.defaultSymbols.polygonBarriers&&(this._sketchViewModel.polygonSymbol=this.layer.defaultSymbols.polygonBarriers.clone())}switch(e){case"stop":case"point-barrier":return this._sketchViewModel.create("point");case"polyline-barrier":return this._sketchViewModel.create("polyline");case"polygon-barrier":return this._sketchViewModel.create("polygon")}}remove(e){const t=this._graphicsLayer.graphics.find(t=>me(t)===e);t&&this._graphicsLayer.remove(t),this._removeNetworkFeature(e)}_activate(){this._loadClonedGraphics(),this.view.map.add(this._graphicsLayer)}_deactivate(){this._sketchViewModel.cancel(),this.view.map?.remove(this._graphicsLayer),this._graphicsLayer.removeAll()}_loadClonedGraphics(){const e=[this.layer.stops,this.layer.pointBarriers,this.layer.polylineBarriers,this.layer.polygonBarriers].flatMap(e=>e.toArray().map(e=>{const t=e.toGraphic();return t.networkFeature=e,t}));this._graphicsLayer.removeAll().addMany(e)}_removeNetworkFeature(e){switch(e.type){case"stop":this.layer.stops.remove(e);break;case"point-barrier":this.layer.pointBarriers.remove(e);break;case"polyline-barrier":this.layer.polylineBarriers.remove(e);break;case"polygon-barrier":this.layer.polygonBarriers.remove(e)}}};(0,i._)([(0,p.MZ)()],fe.prototype,"enabled",void 0),(0,i._)([(0,p.MZ)({constructOnly:!0})],fe.prototype,"layer",void 0),(0,i._)([(0,p.MZ)({readOnly:!0})],fe.prototype,"selectedNetworkFeatures",null),(0,i._)([(0,p.MZ)()],fe.prototype,"updating",null),(0,i._)([(0,p.MZ)({constructOnly:!0})],fe.prototype,"view",void 0),fe=(0,i._)([(0,c.$)("esri.views.2d.layers.support.RouteLayerInteraction")],fe)},61492:(e,t,o)=>{o.d(t,{c:()=>a,d:()=>i});var i;o(81806);function a(e){switch(e){case i.SUPPORTED:break;case i.GRAPHICS_LAYER_MISSING:return"not owned by a graphics layer";case i.GEOMETRY_MISSING:return"no geometry";case i.GEOMETRY_TYPE_UNSUPPORTED:return"the geometry type is not supported";case i.ELEVATION_MODE_UNSUPPORTED:return"the elevation mode is not supported";case i.SYMBOL_TYPE_UNSUPPORTED:return"the symbol type is not supported"}return""}!function(e){e[e.SUPPORTED=0]="SUPPORTED",e[e.GRAPHICS_LAYER_MISSING=1]="GRAPHICS_LAYER_MISSING",e[e.GEOMETRY_MISSING=2]="GEOMETRY_MISSING",e[e.GEOMETRY_TYPE_UNSUPPORTED=3]="GEOMETRY_TYPE_UNSUPPORTED",e[e.ELEVATION_MODE_UNSUPPORTED=4]="ELEVATION_MODE_UNSUPPORTED",e[e.SYMBOL_TYPE_UNSUPPORTED=5]="SYMBOL_TYPE_UNSUPPORTED"}(i||(i={}))},63733:(e,t,o)=>{o.d(t,{A:()=>d});var i=o(35143),a=o(46053),r=(o(81806),o(76460),o(47249),o(85842)),s=o(5364),n=o(25515),p=o(65624),l=o(5682),c=o(64519),h=o(731);let d=class extends((0,p.dM)((0,l.j)(n.A))){constructor(e){super(e),this.elevationInfo=null,this.graphics=new c.Y,this.screenSizePerspectiveEnabled=!0,this.type="graphics",this.internal=!1}destroy(){this.removeAll(),this.graphics.destroy()}add(e){return this.graphics.add(e),this}addMany(e){return this.graphics.addMany(e),this}removeAll(){return this.graphics.removeAll(),this}remove(e){this.graphics.remove(e)}removeMany(e){this.graphics.removeMany(e)}on(e,t){return super.on(e,t)}graphicChanged(e){this.emit("graphic-update",e)}};(0,i._)([(0,a.MZ)({type:h.A})],d.prototype,"elevationInfo",void 0),(0,i._)([(0,a.MZ)((0,s.C)(c.Y,"graphics"))],d.prototype,"graphics",void 0),(0,i._)([(0,a.MZ)({type:["show","hide"]})],d.prototype,"listMode",void 0),(0,i._)([(0,a.MZ)()],d.prototype,"screenSizePerspectiveEnabled",void 0),(0,i._)([(0,a.MZ)({readOnly:!0})],d.prototype,"type",void 0),(0,i._)([(0,a.MZ)({constructOnly:!0})],d.prototype,"internal",void 0),d=(0,i._)([(0,r.$)("esri.layers.GraphicsLayer")],d)},66678:(e,t,o)=>{o.d(t,{c:()=>n});var i=o(24648),a=o(7137),r=o(90659);const s=e=>({geodesicArea(t){const{spatialReference:o}=t;return(0,r.M0)(o,p,t=>function(e,t){try{return(0,i.gT)(Math.abs(e.geodesicArea(t,"square-meters")),"square-meters")}catch(o){return null}}(e,t),t)}});async function n(){const e=await Promise.all([o.e(52612),o.e(63391)]).then(o.bind(o,63391));return s(e)}function p(e){return(0,i.gT)(Math.abs((0,a.qy)([e],"square-meters")[0]),"square-meters")}},68655:(e,t,o)=>{o.d(t,{f:()=>s});var i=o(9392),a=o(29772),r=o(23739);async function s(){return e=await(0,r.V)(),{autoLength2D:t=>e.geodesicLength(t)??(0,a.Xg)(t),autoDistanceBetweenPoints2D:(t,o)=>e.geodesicDistanceBetweenPoints(t,o)??(0,a.ll)(t,o),autoDistance2D:(t,o,i)=>(n[0]=t[0],n[1]=t[1],n[2]=3===t.length?t[2]:0,p[0]=o[0],p[1]=o[1],p[2]=3===o.length?o[2]:0,e.geodesicDistance(n,p,i)??(0,a.sT)(n,p,i))};var e}const n=(0,i.vt)(),p=(0,i.vt)()},69120:(e,t,o)=>{o.d(t,{Nu:()=>n,Y3:()=>r,in:()=>s});var i=o(70445),a=o(31933);function r(e,t,o){if(!t||!e?.map)return;const{map:i}=e,a=i.layers.find(e=>e===t);a||i.add(t,o),a&&null!=o&&i.layers.reorder(a,o)}function s(e,t){const o="subtype-sublayer"===t?.type?t.parent:t;return e.allLayerViews.find(e=>{const t=e.layer;return t===o||"sublayers"in t&&null!=t.sublayers&&t.sublayers.includes(o)})}function n(e){return(0,i.S)(e)||(0,a.Sv)(e)||(0,a.V0)(e)||(0,a.UC)(e)}},73265:(e,t,o)=>{o.d(t,{A:()=>h});var i=o(35143),a=o(91967),r=o(46053),s=(o(81806),o(76460),o(47249),o(85842));let n=class extends a.A{constructor(e){super(e),this.length=null,this.verticalLength=null,this.area=null}};(0,i._)([(0,r.MZ)()],n.prototype,"length",void 0),(0,i._)([(0,r.MZ)()],n.prototype,"verticalLength",void 0),(0,i._)([(0,r.MZ)()],n.prototype,"area",void 0),n=(0,i._)([(0,s.$)("esri.views.interactive.sketch.Units")],n);const p=n;var l=o(89646);let c=class extends a.A{constructor(e){super(e),this.directionMode="relative",this.relativeDirectionIsBilateral=!1}get effectiveDirectionMode(){switch(this.directionMode){case"relative":return this.relativeDirectionIsBilateral?l.rZ.RelativeBilateral:l.rZ.Relative;case"absolute":return l.rZ.Absolute}}get displayUnits(){return this._get("displayUnits")??new p}set displayUnits(e){this._set("displayUnits",e)}get inputUnits(){return this._get("inputUnits")??new p}set inputUnits(e){this._set("inputUnits",e)}};(0,i._)([(0,r.MZ)({type:String,nonNullable:!0})],c.prototype,"directionMode",void 0),(0,i._)([(0,r.MZ)({type:Boolean,nonNullable:!0})],c.prototype,"relativeDirectionIsBilateral",void 0),(0,i._)([(0,r.MZ)()],c.prototype,"effectiveDirectionMode",null),(0,i._)([(0,r.MZ)({type:p,nonNullable:!0})],c.prototype,"displayUnits",null),(0,i._)([(0,r.MZ)({type:p,nonNullable:!0})],c.prototype,"inputUnits",null),c=(0,i._)([(0,s.$)("esri.views.interactive.sketch.SketchValueOptions")],c);const h=c},78009:(e,t,o)=>{o.d(t,{EI:()=>d,lO:()=>_,qh:()=>u,u0:()=>m});var i=o(24648),a=o(31633),r=o(38983),s=o(20664),n=o(9392),p=o(14487),l=o(13927),c=o(45097),h=o(41868);function d(e){return y(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{positionsWorldCoords:[]})}function u(e){return y(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{positionsWorldCoords:[]},!1)}function y(e,t){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.hasZ;const r=(0,h.l)(e.spatialReference),d=(0,a.B5)(r);if(null==d)return null;const u=(e,t)=>!(t.length<2)&&((0,s.i)(e,t[0],t[1],o&&t[2]||0),!0);let y=0;for(const i of e.rings){const o=i.length;if(o<3)continue;const{positionsWorldCoords:a}=t;for(;a.length<o;)a.push((0,n.vt)());const h=g,d=(0,s.i)(v,0,0,0),m=1/o;for(let t=0;t<o;t++){if(!u(h,i[t]))return null;if(!(0,p.F)(h,e.spatialReference,a[t],r))return null;(0,s.b)(d,d,a[t],m)}const f=(0,l.Cr)(a[0],a[1],d,(0,l.LV)());if(0===(0,s.k)((0,l.Qj)(f)))continue;for(let e=0;e<o;e++)(0,l.Z1)(f,d,a[e],a[e]);const b=_(a);for(let e=0;e<b.length;e+=3)y+=(0,c.Fm)(a[b[e]],a[b[e+1]],a[b[e+2]])}return(0,i.gT)(y,d)}const g=(0,n.vt)(),v=(0,n.vt)();function m(){return{positionsWorldCoords:[]}}function _(e){return(0,r.e)(function(e){const t=new Float64Array(2*e.length);for(let o=0;o<e.length;++o){const i=e[o],a=2*o;t[a]=i[0],t[a+1]=i[1]}return t}(e),[],2)}},89646:(e,t,o)=>{o.d(t,{$h:()=>g,Ef:()=>O,IP:()=>m,P1:()=>w,hF:()=>E,jQ:()=>b,rT:()=>M,rZ:()=>i,uR:()=>_});var i,a,r=o(73582),s=o(24648),n=o(31633),p=o(19555),l=o(72745),c=o(20664),h=o(9392),d=o(14487),u=o(7137),y=o(80963);function g(e,t){if(null==e||null==t)return;const o=v(e,t);return null!=o?(0,s.Wq)(o,"radians","geographic"):void 0}(a=i||(i={})).Absolute="absolute",a.Relative="relative",a.RelativeBilateral="relative-bilateral";const v=(()=>{const e=(0,h.vt)(),t=(0,h.vt)();return(o,i)=>((0,c.i)(e,o.x,o.y,o.z??0),(0,c.i)(t,i.x,i.y,i.z??0),m(e,t,o.spatialReference,i.spatialReference))})(),m=(()=>{const e=(0,l.vt)(),t=(0,h.vt)(),o=(0,h.vt)();return(i,a,r,s)=>{if((0,c.q)(i,a))return;const h=(0,u.Xn)(r),g=(0,u.Xn)(s);if(h&&g&&(0,y.aI)(h,g)&&(0,d.F)(i,r,t,h)&&(0,d.F)(a,s,o,g)){const{azimuth:e}=(0,u._3)(T,t,o,h);return null!=e?(0,n.oU)(e,"degrees","radians"):void 0}e[0]=a[0]-i[0],e[1]=a[1]-i[1];let v=(0,p.g7)(l.JP,e);return e[0]<0&&(v=S-v),v}})();function _(e,t,o){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:i.Absolute;if(t&&o)switch(a){case i.Absolute:return g(t,o);case i.Relative:return b(f(e,t,o),i.Relative);case i.RelativeBilateral:return b(f(e,t,o),i.RelativeBilateral)}}function f(e,t,o){if(!e||!t||!o)return;const i=v(e,t),a=v(t,o);return null!=i&&null!=a?(0,s.Wq)(a-i,"radians","geographic"):void 0}function b(e,t){if(null!=e)switch(t){case i.Absolute:return w(e);case i.Relative:{const t=E(e);let o=k.normalize(t,0,!0);return-180===o&&(o=180),(0,s.Wq)(o,"degrees","geographic")}case i.RelativeBilateral:{const t=E(e),o=Math.abs(k.normalize(t,0,!0));return(0,s.Wq)(o,"degrees","geographic")}}}function w(e){const t=E(e),o=A.normalize(t,0,!0);return(0,s.Wq)(o,"degrees","geographic")}const M=(()=>{const e=(0,h.vt)();return function(t,o,i,a,r){let p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"geodesic";(0,c.c)(e,o);const l=E(r);if("geodesic"===p){const r=(0,u.Xn)(i);if(r&&(0,d.F)(e,i,e,r))return(0,u.vN)(t,e,l,a,r),t[2]=o[2],!!(0,d.F)(t,r,t,i)}const h=(0,s.g2)(l,"geographic","arithmetic"),y=(0,n.oU)(h,"degrees","radians"),g=o[0]+a*Math.cos(y),v=o[1]+a*Math.sin(y),m=o[2];return(0,c.i)(t,g,v,m),!0}})();function E(e){if(null!=e)return(0,s.g2)(G(e),e.rotationType,"geographic")}function O(e){if(null!=e)return(0,s.g2)(G(e),e.rotationType,"arithmetic")}function G(e){return(0,n.oU)(e.value,e.unit,"degrees")}const T=new u.Zj,S=2*Math.PI,A=r.ie,k=new r.hr(-180,180)},95327:(e,t,o)=>{o.d(t,{A:()=>p});var i=o(35143),a=o(91967),r=o(46053),s=(o(81806),o(76460),o(47249),o(85842));let n=class extends a.A{constructor(e){super(e),this.enabled=!1}};(0,i._)([(0,r.MZ)({type:Boolean,nonNullable:!0})],n.prototype,"enabled",void 0),n=(0,i._)([(0,s.$)("esri.views.interactive.sketch.SketchLabelOptions")],n);const p=n},97513:(e,t,o)=>{o.d(t,{A:()=>h});var i=o(35143),a=o(91967),r=o(46053),s=(o(81806),o(76460),o(47249),o(85842)),n=o(95327),p=o(357),l=o(73265);let c=class extends a.A{constructor(e){super(e),this.labels=new n.A,this.tooltips=new p.A,this.values=new l.A}};(0,i._)([(0,r.MZ)({nonNullable:!0,type:n.A})],c.prototype,"labels",void 0),(0,i._)([(0,r.MZ)({nonNullable:!0,type:p.A})],c.prototype,"tooltips",void 0),(0,i._)([(0,r.MZ)({nonNullable:!0,type:l.A})],c.prototype,"values",void 0),c=(0,i._)([(0,s.$)("esri.views.interactive.sketch.SketchOptions")],c);const h=c}}]);
//# sourceMappingURL=54090.ba5ff3c0.chunk.js.map