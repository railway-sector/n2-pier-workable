"use strict";(self.webpackChunkn2_pier_workable=self.webpackChunkn2_pier_workable||[]).push([[66167],{114:(e,t,a)=>{a.d(t,{P:()=>f});var i=a(59422),n=a(62887),r=a(76418),s=a(5095),o=a(40480),l=a(3986),c=a(93345);const u=1/65536;class f extends l.A{constructor(){super(...arguments),this._iconProgramOptions={id:!1,sdf:!1},this._sdfProgramOptions={id:!1},this._spritesTextureSize=(0,i.vt)()}dispose(){}drawMany(e,t){const a=e.styleLayer;this._drawIcons(e,a,t),this._drawText(e,a,t)}_drawIcons(e,t,a){const{context:i,displayLevel:l,painter:c,spriteMosaic:u,state:f,styleLayerUID:d,requestRender:p,allowDelayedRender:g}=e,m=t.iconMaterial,_=c.vectorTilesMaterialManager;let y,M=!1;for(const n of a)if(n.layerData.has(d)&&(y=n.layerData.get(d),y.iconPerPageElementsMap.size>0)){M=!0;break}if(!M)return;const h=t.getPaintValue("icon-translate",l),U=t.getPaintValue("icon-translate-anchor",l);let v=t.getLayoutValue("icon-rotation-alignment",l);v===r.I5.AUTO&&(v=t.getLayoutValue("symbol-placement",l)===r.kt.POINT?r.I5.VIEWPORT:r.I5.MAP);const E=v===r.I5.MAP,P=t.getLayoutValue("icon-keep-upright",l)&&E,I=y.isIconSDF,x=this._iconProgramOptions;x.sdf=I;const R=_.getMaterialProgram(i,m,x);if(g&&null!=p&&!R.compiled)return void p();i.useProgram(R),R.setUniformMatrix3fv("u_displayViewMat3",v===r.I5.MAP?f.displayViewMat3:f.displayMat3),R.setUniformMatrix3fv("u_displayMat3",U===r.Cq.VIEWPORT?f.displayMat3:f.displayViewMat3),R.setUniform2fv("u_iconTranslation",h),R.setUniform1f("u_depth",t.z),R.setUniform1f("u_mapRotation",(0,o.wV)(f.rotation)),R.setUniform1f("u_keepUpright",P?1:0),R.setUniform1f("u_level",10*l),R.setUniform1i("u_texture",s.$U),R.setUniform1f("u_fadeDuration",n.zk/1e3);let T=-1;for(const n of a){if(!n.layerData.has(d))continue;if(n.key.level!==T&&(T=n.key.level,m.setDataUniforms(R,l,t,T,u)),y=n.layerData.get(d),0===y.iconPerPageElementsMap.size)continue;y.prepareForRendering(i),y.updateOpacityInfo();const a=y.iconVAO;if(null!=a){i.bindVAO(a),R.setUniformMatrix3fv("u_dvsMat3",n.transforms.displayViewScreenMat3),R.setUniform1f("u_time",(performance.now()-y.lastOpacityUpdate)/1e3);for(const[t,a]of y.iconPerPageElementsMap)this._renderIconRange(e,R,a,t,n)}}}_renderIconRange(e,t,a,i,n){const{context:r,spriteMosaic:o}=e;this._spritesTextureSize[0]=o.getWidth(i)/4,this._spritesTextureSize[1]=o.getHeight(i)/4,t.setUniform2fv("u_mosaicSize",this._spritesTextureSize),o.bind(r,c.Cj.LINEAR,i,s.$U),this._setStencilState(e,n),r.drawElements(c.WR.TRIANGLES,a[1],c.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*a[0]),n.triangleCount+=a[1]/3}_drawText(e,t,a){const{context:l,displayLevel:c,glyphMosaic:f,painter:d,pixelRatio:p,spriteMosaic:g,state:m,styleLayerUID:_,requestRender:y,allowDelayedRender:M}=e,h=t.textMaterial,U=d.vectorTilesMaterialManager;let v,E=!1;for(const i of a)if(i.layerData.has(_)&&(v=i.layerData.get(_),v.glyphPerPageElementsMap.size>0)){E=!0;break}if(!E)return;const P=t.getPaintProperty("text-opacity");if(P&&!P.isDataDriven&&0===P.getValue(c))return;const I=t.getPaintProperty("text-color"),x=!I||I.isDataDriven||I.getValue(c)[3]>0,R=t.getPaintProperty("text-halo-width"),T=t.getPaintProperty("text-halo-color"),S=(!R||R.isDataDriven||R.getValue(c)>0)&&(!T||T.isDataDriven||T.getValue(c)[3]>0);if(!x&&!S)return;let w=t.getLayoutValue("text-rotation-alignment",c);w===r.I5.AUTO&&(w=t.getLayoutValue("symbol-placement",c)===r.kt.POINT?r.I5.VIEWPORT:r.I5.MAP);const D=w===r.I5.MAP,V=t.getLayoutValue("text-keep-upright",c)&&D,A=.8*3/p;this._glyphTextureSize||(this._glyphTextureSize=(0,i.fA)(f.width/4,f.height/4));const L=t.getPaintValue("text-translate",c),N=t.getPaintValue("text-translate-anchor",c),O=this._sdfProgramOptions,C=U.getMaterialProgram(l,h,O);if(M&&null!=y&&!C.compiled)return void y();l.useProgram(C),C.setUniformMatrix3fv("u_displayViewMat3",w===r.I5.MAP?m.displayViewMat3:m.displayMat3),C.setUniformMatrix3fv("u_displayMat3",N===r.Cq.VIEWPORT?m.displayMat3:m.displayViewMat3),C.setUniform2fv("u_textTranslation",L),C.setUniform1f("u_depth",t.z+u),C.setUniform2fv("u_mosaicSize",this._glyphTextureSize),C.setUniform1f("u_mapRotation",(0,o.wV)(m.rotation)),C.setUniform1f("u_keepUpright",V?1:0),C.setUniform1f("u_level",10*c),C.setUniform1i("u_texture",s.mg),C.setUniform1f("u_antialiasingWidth",A),C.setUniform1f("u_fadeDuration",n.zk/1e3);let k=-1;for(const i of a){if(!i.layerData.has(_))continue;if(i.key.level!==k&&(k=i.key.level,h.setDataUniforms(C,c,t,k,g)),v=i.layerData.get(_),0===v.glyphPerPageElementsMap.size)continue;v.prepareForRendering(l),v.updateOpacityInfo();const a=v.textVAO;if(null==a)continue;l.bindVAO(a),C.setUniformMatrix3fv("u_dvsMat3",i.transforms.displayViewScreenMat3),this._setStencilState(e,i);const n=(performance.now()-v.lastOpacityUpdate)/1e3;C.setUniform1f("u_time",n),v.glyphPerPageElementsMap.forEach((e,t)=>{this._renderGlyphRange(l,e,t,f,C,S,x,i)})}}_renderGlyphRange(e,t,a,i,n,r,o,l){i.bind(e,c.Cj.LINEAR,a,s.mg),r&&(n.setUniform1f("u_halo",1),e.drawElements(c.WR.TRIANGLES,t[1],c.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*t[0]),l.triangleCount+=t[1]/3),o&&(n.setUniform1f("u_halo",0),e.drawElements(c.WR.TRIANGLES,t[1],c.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*t[0]),l.triangleCount+=t[1]/3)}_setStencilState(e,t){const{context:a,is3D:i,stencilSymbols:n}=e;if(a.setStencilTestEnabled(!0),n)return a.setStencilWriteMask(255),void a.setStencilFunction(c.MT.ALWAYS,t.stencilRef,255);a.setStencilWriteMask(0),i?a.setStencilFunction(c.MT.EQUAL,t.stencilRef,255):a.setStencilFunction(c.MT.GREATER,255,255)}}},3986:(e,t,a)=>{a.d(t,{A:()=>i});class i{constructor(){this.name=this.constructor.name||"UnnamedBrush",this.brushEffect=null}prepareState(e,t){}draw(e,t,a){}drawMany(e,t,a){for(const i of t)i.visible&&this.draw(e,i,a)}}},38134:(e,t,a)=>{a.d(t,{F:()=>f});var i=a(15941),n=a(85827),r=a(28608),s=a(5095),o=a(3986),l=a(76718),c=a(93345),u=a(36911);class f extends o.A{constructor(){super(...arguments),this._color=(0,r.fA)(1,0,0,1),this._patternMatrix=(0,n.vt)(),this._programOptions={id:!1,pattern:!1}}dispose(){this._vao&&(this._vao.dispose(),this._vao=null)}drawMany(e,t){const{context:a,painter:n,requestRender:r,allowDelayedRender:o}=e;this._loadWGLResources(e);const l=e.displayLevel,u=e.styleLayer,f=u.backgroundMaterial,d=n.vectorTilesMaterialManager,p=u.getPaintValue("background-color",l),g=u.getPaintValue("background-opacity",l),m=u.getPaintValue("background-pattern",l),_=void 0!==m,y=1|window.devicePixelRatio,M=e.spriteMosaic;let h,U;const v=y>s.C_?2:1,E=this._programOptions;E.pattern=_;const P=d.getMaterialProgram(a,f,E);if(!o||null==r||P.compiled){if(a.bindVAO(this._vao),a.useProgram(P),_){const e=M.getMosaicItemPosition(m,!0);if(null!=e){const{tl:t,br:i,page:n}=e;h=i[0]-t[0],U=i[1]-t[1];const r=M.getPageSize(n);null!=r&&(M.bind(a,c.Cj.LINEAR,n,s.$U),P.setUniform4f("u_tlbr",t[0],t[1],i[0],i[1]),P.setUniform2fv("u_mosaicSize",r),P.setUniform1i("u_texture",s.$U))}P.setUniform1f("u_opacity",g)}else{const e=p[3]*g;this._color[0]=e*p[0],this._color[1]=e*p[1],this._color[2]=e*p[2],this._color[3]=e,P.setUniform4fv("u_color",this._color)}P.setUniform1f("u_depth",u.z||0);for(const e of t){if(P.setUniform1f("u_coord_range",e.rangeX),P.setUniformMatrix3fv("u_dvsMat3",e.transforms.displayViewScreenMat3),_){const t=Math.max(2**(Math.round(l)-e.key.level),1),a=v*e.width*t,n=a/(0,i.yR)(h),r=a/(0,i.yR)(U);this._patternMatrix[0]=n,this._patternMatrix[4]=r,P.setUniformMatrix3fv("u_pattern_matrix",this._patternMatrix)}a.setStencilFunction(c.MT.EQUAL,0,255),a.drawArrays(c.WR.TRIANGLE_STRIP,0,4)}}else r()}_loadWGLResources(e){if(this._vao)return;const{context:t,styleLayer:a}=e,i=a.backgroundMaterial,n=new Int8Array([0,0,1,0,0,1,1,1]),r=l.g.createVertex(t,c._U.STATIC_DRAW,n),s=new u.Z(t,i.getAttributeLocations(),i.getLayoutInfo(),new Map([["geometry",r]]));this._vao=s}}},40480:(e,t,a)=>{a.d(t,{p6:()=>o,wV:()=>s});Math.PI;const i=256/360,n=1/Math.LN2;function r(e,t){return(e%=t)>=0?e:e+t}function s(e){return r(e*i,256)}function o(e){return Math.log(e)*n}},43106:(e,t,a)=>{a.d(t,{p:()=>s});var i=a(76418),n=a(3986),r=a(93345);class s extends n.A{constructor(){super(...arguments),this._programOptions={id:!1}}dispose(){}drawMany(e,t){const{context:a,displayLevel:n,requiredLevel:s,state:o,painter:l,spriteMosaic:c,styleLayerUID:u,requestRender:f,allowDelayedRender:d}=e;if(!t.some(e=>e.layerData.get(u)?.circleIndexCount??!1))return;const p=e.styleLayer,g=p.circleMaterial,m=l.vectorTilesMaterialManager,_=p.getPaintValue("circle-translate",n),y=p.getPaintValue("circle-translate-anchor",n),M=this._programOptions,h=m.getMaterialProgram(a,g,M);if(d&&null!=f&&!h.compiled)return void f();a.useProgram(h),h.setUniformMatrix3fv("u_displayMat3",y===i.Cq.VIEWPORT?o.displayMat3:o.displayViewMat3),h.setUniform2fv("u_circleTranslation",_),h.setUniform1f("u_depth",p.z),h.setUniform1f("u_antialiasingWidth",1.2);let U=-1;for(const i of t){if(!i.layerData.has(u))continue;i.key.level!==U&&(U=i.key.level,g.setDataUniforms(h,n,p,U,c));const e=i.layerData.get(u);if(!e.circleIndexCount)continue;e.prepareForRendering(a);const t=e.vao;null!=t&&(a.bindVAO(t),h.setUniformMatrix3fv("u_dvsMat3",i.transforms.displayViewScreenMat3),s!==i.key.level?a.setStencilFunction(r.MT.EQUAL,i.stencilRef,255):a.setStencilFunction(r.MT.GREATER,255,255),a.drawElements(r.WR.TRIANGLES,e.circleIndexCount,r.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*e.circleIndexStart),i.triangleCount+=e.circleIndexCount/3)}}}},51519:(e,t,a)=>{a.d(t,{I:()=>l});var i=a(76418),n=a(5095),r=a(3986),s=a(93345);const o=1/65536;class l extends r.A{constructor(){super(...arguments),this._fillProgramOptions={id:!1,pattern:!1},this._outlineProgramOptions={id:!1}}dispose(){}drawMany(e,t){const{displayLevel:a,renderPass:i,spriteMosaic:n,styleLayerUID:r}=e;let s=!1;for(const M of t)if(M.layerData.has(r)){const e=M.layerData.get(r);if(e.fillIndexCount>0||e.outlineIndexCount>0){s=!0;break}}if(!s)return;const o=e.styleLayer,l=o.getPaintProperty("fill-pattern"),c=void 0!==l,u=c&&l.isDataDriven;let f;if(c&&!u){const e=l.getValue(a);f=n.getMosaicItemPosition(e,!0)}const d=!c&&o.getPaintValue("fill-antialias",a);let p=!0,g=1;if(!c){const e=o.getPaintProperty("fill-color"),t=o.getPaintProperty("fill-opacity");if(!e?.isDataDriven&&!t?.isDataDriven){const e=o.getPaintValue("fill-color",a);g=o.getPaintValue("fill-opacity",a)*e[3],g>=1&&(p=!1)}}if(p&&"opaque"===i)return;const m=o.getPaintValue("fill-translate",a),_=o.getPaintValue("fill-translate-anchor",a);(p||"translucent"!==i)&&this._drawFill(e,r,o,t,m,_,c,f,u);const y=!o.hasDataDrivenOutlineColor&&o.outlineUsesFillColor&&g<1;d&&"opaque"!==i&&!y&&this._drawOutline(e,r,o,t,m,_)}_drawFill(e,t,a,r,l,c,u,f,d){if(u&&!d&&null==f)return;const{context:p,displayLevel:g,state:m,painter:_,pixelRatio:y,spriteMosaic:M,requestRender:h,allowDelayedRender:U}=e,v=a.fillMaterial,E=_.vectorTilesMaterialManager,P=y>n.C_?2:1,I=this._fillProgramOptions;I.pattern=u;const x=E.getMaterialProgram(p,v,I);if(U&&null!=h&&!x.compiled)return void h();if(p.useProgram(x),null!=f){const{page:e}=f,t=M.getPageSize(e);null!=t&&(M.bind(p,s.Cj.LINEAR,e,n.$U),x.setUniform2fv("u_mosaicSize",t),x.setUniform1i("u_texture",n.$U))}x.setUniformMatrix3fv("u_displayMat3",c===i.Cq.VIEWPORT?m.displayMat3:m.displayViewMat3),x.setUniform2fv("u_fillTranslation",l),x.setUniform1f("u_depth",a.z+o);let R=-1;for(const i of r){if(!i.layerData.has(t))continue;i.key.level!==R&&(R=i.key.level,v.setDataUniforms(x,g,a,R,M));const e=i.layerData.get(t);if(!e.fillIndexCount)continue;e.prepareForRendering(p);const r=e.fillVAO;if(null!=r){if(p.bindVAO(r),x.setUniformMatrix3fv("u_dvsMat3",i.transforms.displayViewScreenMat3),p.setStencilFunction(s.MT.EQUAL,i.stencilRef,255),u){const e=Math.max(2**(Math.round(g)-i.key.level),1),t=i.rangeX/(P*i.width*e);x.setUniform1f("u_patternFactor",t)}if(d){const t=e.patternMap;if(!t)continue;for(const[e,a]of t){const t=M.getPageSize(e);null!=t&&(M.bind(p,s.Cj.LINEAR,e,n.$U),x.setUniform2fv("u_mosaicSize",t),x.setUniform1i("u_texture",n.$U),p.drawElements(s.WR.TRIANGLES,a[1],s.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*a[0]))}}else p.drawElements(s.WR.TRIANGLES,e.fillIndexCount,s.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*e.fillIndexStart);i.triangleCount+=e.fillIndexCount/3}}}_drawOutline(e,t,a,n,r,l){const{context:c,displayLevel:u,state:f,painter:d,pixelRatio:p,spriteMosaic:g,requestRender:m,allowDelayedRender:_}=e,y=a.outlineMaterial,M=d.vectorTilesMaterialManager,h=.75/p,U=this._outlineProgramOptions,v=M.getMaterialProgram(c,y,U);if(_&&null!=m&&!v.compiled)return void m();c.useProgram(v),v.setUniformMatrix3fv("u_displayMat3",l===i.Cq.VIEWPORT?f.displayMat3:f.displayViewMat3),v.setUniform2fv("u_fillTranslation",r),v.setUniform1f("u_depth",a.z+o),v.setUniform1f("u_outline_width",h);let E=-1;for(const i of n){if(!i.layerData.has(t))continue;i.key.level!==E&&(E=i.key.level,y.setDataUniforms(v,u,a,E,g));const e=i.layerData.get(t);if(e.prepareForRendering(c),!e.outlineIndexCount)continue;const n=e.outlineVAO;null!=n&&(c.bindVAO(n),v.setUniformMatrix3fv("u_dvsMat3",i.transforms.displayViewScreenMat3),c.setStencilFunction(s.MT.EQUAL,i.stencilRef,255),c.drawElements(s.WR.TRIANGLES,e.outlineIndexCount,s.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*e.outlineIndexStart),i.triangleCount+=e.outlineIndexCount/3)}}}},56012:(e,t,a)=>{a.d(t,{$:()=>o});var i=a(76418),n=a(5095),r=a(3986),s=a(93345);class o extends r.A{constructor(){super(...arguments),this._programOptions={id:!1,pattern:!1,sdf:!1}}dispose(){}drawMany(e,t){const{context:a,displayLevel:r,state:o,painter:l,pixelRatio:c,spriteMosaic:u,styleLayerUID:f,requestRender:d,allowDelayedRender:p}=e;if(!t.some(e=>e.layerData.get(f)?.lineIndexCount??!1))return;const g=e.styleLayer,m=g.lineMaterial,_=l.vectorTilesMaterialManager,y=g.getPaintValue("line-translate",r),M=g.getPaintValue("line-translate-anchor",r),h=g.getPaintProperty("line-pattern"),U=void 0!==h,v=U&&h.isDataDriven;let E,P;if(U&&!v){const e=h.getValue(r);E=u.getMosaicItemPosition(e)}let I=!1;if(!U){const e=g.getPaintProperty("line-dasharray");if(P=void 0!==e,I=P&&e.isDataDriven,P&&!I){const t=e.getValue(r),a=g.getDashKey(t,g.getLayoutValue("line-cap",r));E=u.getMosaicItemPosition(a)}}const x=1/c,R=this._programOptions;R.pattern=U,R.sdf=P;const T=_.getMaterialProgram(a,m,R);if(p&&null!=d&&!T.compiled)return void d();if(a.useProgram(T),T.setUniformMatrix3fv("u_displayViewMat3",o.displayViewMat3),T.setUniformMatrix3fv("u_displayMat3",M===i.Cq.VIEWPORT?o.displayMat3:o.displayViewMat3),T.setUniform2fv("u_lineTranslation",y),T.setUniform1f("u_depth",g.z),T.setUniform1f("u_antialiasing",x),E&&null!=E){const{page:e}=E,t=u.getPageSize(e);null!=t&&(u.bind(a,s.Cj.LINEAR,e,n.$U),T.setUniform2fv("u_mosaicSize",t),T.setUniform1i("u_texture",n.$U))}let S=-1;for(const i of t){if(!i.layerData.has(f))continue;i.key.level!==S&&(S=i.key.level,m.setDataUniforms(T,r,g,S,u));const e=2**(r-S)/c;T.setUniform1f("u_zoomFactor",e);const t=i.layerData.get(f);if(!t.lineIndexCount)continue;t.prepareForRendering(a);const o=t.vao;if(null!=o){if(a.bindVAO(o),T.setUniformMatrix3fv("u_dvsMat3",i.transforms.displayViewScreenMat3),a.setStencilFunction(s.MT.EQUAL,i.stencilRef,255),v||I){const e=t.patternMap;if(!e)continue;for(const[t,i]of e){const e=u.getPageSize(t);null!=e&&(u.bind(a,s.Cj.LINEAR,t,n.$U),T.setUniform2fv("u_mosaicSize",e),T.setUniform1i("u_texture",n.$U),a.drawElements(s.WR.TRIANGLES,i[1],s.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*i[0]))}}else a.drawElements(s.WR.TRIANGLES,t.lineIndexCount,s.pe.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*t.lineIndexStart);i.triangleCount+=t.lineIndexCount/3}}}}},78403:(e,t,a)=>{a.d(t,{Z:()=>i});class i{constructor(e){this._readFile=e}resolveIncludes(e){return this._resolve(e)}_resolve(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Map;if(t.has(e))return t.get(e);const a=this._read(e);if(!a)throw new Error(`cannot find shader file ${e}`);const i=/^[^\S\n]*#include\s+<(\S+)>[^\S\n]?/gm;let n=i.exec(a);const r=[];for(;null!=n;)r.push({path:n[1],start:n.index,length:n[0].length}),n=i.exec(a);let s=0,o="";return r.forEach(e=>{o+=a.slice(s,e.start),o+=t.has(e.path)?"":this._resolve(e.path,t),s=e.start+e.length}),o+=a.slice(s),t.set(e,o),o}_read(e){return this._readFile(e)}}}}]);
//# sourceMappingURL=66167.fb6eb59f.chunk.js.map