"use strict";(self.webpackChunkn2_pier_workable=self.webpackChunkn2_pier_workable||[]).push([[77567],{18153:(e,t,n)=>{n.d(t,{$:()=>l,p:()=>c});var i=n(23862),r=n(80794),o=n(9876),s=n(72317);function a(e){let{x:t,y:n,z:r}=e;return(0,i.fA)(t,n,r??0)}function l(e,t){switch(e.type){case"edge":return e.draped?new r.X({edgeStart:a(e.start),edgeEnd:a(e.end),targetPoint:(0,i.de)(a(e.target)),objectId:e.objectId,getGroundElevation:t}):new o.z({edgeStart:a(e.start),edgeEnd:a(e.end),targetPoint:(0,i.de)(a(e.target)),objectId:e.objectId,isDraped:!1});case"vertex":return new s.C({targetPoint:(0,i.de)(a(e.target)),objectId:e.objectId,isDraped:!1})}}function c(e,t){return null!=e&&"3d"===e.type?(n,i)=>e.elevationProvider.getElevation(n,i,0,t,"ground"):()=>null}},23241:(e,t,n)=>{n.d(t,{_:()=>o});var i=n(20664),r=n(64753);class o extends r.m{constructor(e,t,n){super(t,n),this.point=e}equals(e){return e instanceof o&&(0,i.q)(this.point,e.point)}}},35961:(e,t,n)=>{n.d(t,{n:()=>l});n(81806);var i=n(53521),r=n(87663),o=n(50346),s=n(31633),a=n(59097);function l(){let e=arguments.length>1?arguments[1]:void 0;if(arguments.length>0&&void 0!==arguments[0]&&arguments[0]){const{elevationInfo:t,alignPointsInFeatures:n}=e;return new u(t,n)}return new c}class c{async alignCandidates(e,t,n){return e}notifyElevationSourceChange(){}}class u{constructor(e,t){this._elevationInfo=e,this._alignPointsInFeatures=t,this._alignmentsCache=new i.q(1024),this._cacheVersion=0}async alignCandidates(e,t,n){const i=this._elevationInfo;return null==i||"absolute-height"!==i.mode||i.featureExpressionInfo?this._alignComputedElevationCandidates(e,t,n):(function(e,t,n){const{offset:i,unit:r}=n;if(null==i)return;const o=(0,s.G9)(t),l=i*((0,a.Ao)(r??"meters")/o);for(const s of e)switch(s.type){case"edge":s.start.z+=l,s.end.z+=l;continue;case"vertex":s.target.z+=l;continue}}(e,t,i),e)}notifyElevationSourceChange(){this._alignmentsCache.clear(),this._cacheVersion++}async _alignComputedElevationCandidates(e,t,n){const i=new Map;for(const o of e)(0,r.tE)(i,o.objectId,d).push(o);const[s,a,l]=this._prepareQuery(i,t),c=await this._alignPointsInFeatures(s,n);if((0,o.Te)(n),l!==this._cacheVersion)return this._alignComputedElevationCandidates(e,t,n);this._applyCacheAndResponse(s,c,a);const{drapedObjectIds:u,failedObjectIds:p}=c,h=[];for(const r of e){const{objectId:e}=r;u.has(e)&&"edge"===r.type&&(r.draped=!0),p.has(e)||h.push(r)}return h}_prepareQuery(e,t){const n=[],i=[];for(const[r,o]of e){const e=[];for(const t of o)this._addToQueriesOrCachedResult(r,t.target,e,i),"edge"===t.type&&(this._addToQueriesOrCachedResult(r,t.start,e,i),this._addToQueriesOrCachedResult(r,t.end,e,i));0!==e.length&&n.push({objectId:r,points:e})}return[{spatialReference:t.toJSON(),pointsInFeatures:n},i,this._cacheVersion]}_addToQueriesOrCachedResult(e,t,n,i){const r=h(e,t),o=this._alignmentsCache.get(r);null==o?n.push(t):i.push(new p(t,o))}_applyCacheAndResponse(e,t,n){let{elevations:i,drapedObjectIds:r,failedObjectIds:o}=t;for(const l of n)l.apply();let s=0;const a=this._alignmentsCache;for(const{objectId:l,points:c}of e.pointsInFeatures){if(o.has(l)){s+=c.length;continue}const e=!r.has(l);for(const t of c){const n=h(l,t),r=i[s++];t.z=r,e&&a.put(n,r,1)}}}}class p{constructor(e,t){this.point=e,this.z=t}apply(){this.point.z=this.z}}function h(e,t){let{x:n,y:i,z:r,spatialReference:o}=t;return`${e}-${n}-${i}-${r??0}}-wkid:${o?.wkid}`}function d(){return[]}},56002:(e,t,n)=>{function i(e){let t,n,i=[],r=!1;return function(){for(var o=arguments.length,s=new Array(o),a=0;a<o;a++)s[a]=arguments[a];return r&&t===this&&function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(s,i)||(n=e.apply(this,s),t=this,i=s,r=!0),n}}n.d(t,{B:()=>i})},69963:(e,t,n)=>{n.d(t,{H:()=>a});n(81806);var i=n(53084),r=n(53521),o=n(50346),s=n(88685);function a(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?new c(arguments.length>1?arguments[1]:void 0):new l}class l{async fetch(){return[]}notifySymbologyChange(){}}class c{constructor(e){this._getSymbologyCandidates=e,this._candidatesCache=new r.q(1024),this._cacheVersion=0}async fetch(e,t){if(0===e.length)return[];const n=[],r=[],s=this._candidatesCache;for(const o of e){const e=u(o),t=s.get(e);if(t)for(const n of t)r.push((0,i.o8)(n));else n.push(o),s.put(e,[],1)}if(0===n.length)return r;const a=this._cacheVersion,{candidates:l,sourceCandidateIndices:c}=await this._getSymbologyCandidates(n,t);if((0,o.Te)(t),a!==this._cacheVersion)return this.fetch(e,t);const p=[],{length:h}=l;for(let o=0;o<h;++o){const e=l[o],t=u(n[c[o]]),r=s.get(t);r.push(e),s.put(t,r,r.length),p.push((0,i.o8)(e))}return r.concat(p)}notifySymbologyChange(){this._candidatesCache.clear(),this._cacheVersion++}}function u(e){switch(e.type){case"vertex":{const{objectId:t,target:n}=e,i=`${t}-vertex-${n.x}-${n.y}-${n.z??0}`;return(0,s.Wm)(i).toString()}case"edge":{const{objectId:t,start:n,end:i}=e,r=`${t}-edge-${n.x}-${n.y}-${n.z??0}-to-${i.x}-${i.y}-${i.z??0}`;return(0,s.Wm)(r).toString()}default:return""}}},72317:(e,t,n)=>{n.d(t,{C:()=>s});var i=n(75543),r=n(61751),o=n(23241);class s extends r.w{constructor(e){super({...e,constraint:new i.i7(e.targetPoint)})}get hints(){return[new o._(this.targetPoint,this.isDraped,this.domain)]}}},74964:(e,t,n)=>{n.d(t,{z:()=>s});n(81806);class i{filter(e,t){return t}notifyElevationSourceChange(){}}class r{filter(e,t){const{point:n,distance:i}=e,{z:r}=n;if(null==r)return t;if(0===t.length)return t;const s=function(e){return"number"==typeof e?{x:e,y:e,z:e}:e}(i),a=this._updateCandidatesTo3D(t,n,s).filter(o);return a.sort(c),a}_updateCandidatesTo3D(e,t,n){for(const i of e)switch(i.type){case"edge":a(i,t,n);continue;case"vertex":l(i,t,n);continue}return e}}function o(e){return e.distance<=1}function s(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?new r:new i}function a(e,t,n){let{x:i,y:r,z:o}=n;const{start:s,end:a,target:l}=e;e.draped||function(e,t,n,i){const r=i.x-n.x,o=i.y-n.y,s=i.z-n.z,a=r*r+o*o+s*s,l=(t.x-n.x)*r+(t.y-n.y)*o+s*(t.z-n.z),c=Math.min(1,Math.max(0,l/a)),u=n.x+r*c,p=n.y+o*c,h=n.z+s*c;e.x=u,e.y=p,e.z=h}(l,t,s,a);const c=(t.x-l.x)/i,u=(t.y-l.y)/r,p=(t.z-l.z)/o;e.distance=Math.sqrt(c*c+u*u+p*p)}function l(e,t,n){let{x:i,y:r,z:o}=n;const{target:s}=e,a=(t.x-s.x)/i,l=(t.y-s.y)/r,c=(t.z-s.z)/o,u=Math.sqrt(a*a+l*l+c*c);e.distance=u}function c(e,t){return e.distance-t.distance}},77567:(e,t,n)=>{n.r(t),n.d(t,{FeatureCollectionSnappingSource:()=>_});var i=n(35143),r=n(91967),o=n(56002),s=n(50346),a=n(68134),l=n(34154),c=n(46053),u=(n(81806),n(76460),n(47249),n(85842)),p=n(12482),h=n(70330),d=n(18153),y=n(35961),g=n(74964),f=n(69963);let _=class extends r.A{get availability(){return 1}get _snappingElevationAligner(){const{view:e}=this,{layer:t}=this.layerSource,n=null!=e&&"3d"===e.type;if(!n||"subtype-group"===t.type)return(0,y.n)();return(0,y.n)(n,{elevationInfo:t.elevationInfo,alignPointsInFeatures:async(n,i)=>(await(0,s.qr)(e.whenLayerView(t),i)).elevationAlignPointsInFeatures(n,i)})}get _snappingElevationFilter(){const{view:e}=this,t=null!=e&&"3d"===e.type&&"subtype-group"!==this.layerSource.layer.type;return(0,g.z)(t)}get _symbologySnappingFetcher(){const{view:e}=this,{layer:t}=this.layerSource;return null!=e&&"3d"===e.type&&"subtype-group"!==t.type?(0,f.H)(this._symbologySnappingSupported,async(n,i)=>{const r=await e.whenLayerView(t);return(0,s.Te)(i),r.queryForSymbologySnapping({candidates:n,spatialReference:e.spatialReference},i)}):(0,f.H)()}get _layerView(){const{view:e}=this;if(null==e)return null;const{layer:t}=this.layerSource;return e.allLayerViews.find(e=>e.layer===t)}get _layerView3D(){const{view:e}=this;return null==e||"2d"===e.type?null:this._layerView}get _symbologySnappingSupported(){return null!=this._layerView3D&&this._layerView3D.symbologySnappingSupported}initialize(){const{view:e}=this,{layer:t}=this.layerSource;null!=e&&"3d"===e.type&&"subtype-group"!==t.type&&this.addHandles([e.elevationProvider.on("elevation-change",e=>{let{context:n}=e;const{elevationInfo:i}=t;(0,p.Up)(n,i)&&this._snappingElevationAligner.notifyElevationSourceChange()}),(0,a.wB)(()=>t.elevationInfo,()=>this._snappingElevationAligner.notifyElevationSourceChange(),a.Vh),(0,a.wB)(()=>null!=this._layerView3D?this._layerView3D.layer?.renderer:null,()=>this._symbologySnappingFetcher.notifySymbologyChange(),a.Vh),(0,a.on)(()=>this._layerView3D?.layer,["edits","apply-edits","graphic-update"],()=>this._symbologySnappingFetcher.notifySymbologyChange())])}constructor(e){super(e),this.view=null,this.updating=!1,this._memoizedMakeGetGroundElevation=(0,o.B)(d.p)}refresh(){}async fetchCandidates(e,t){const{layer:n}=this.layerSource,{source:i}=n;if(!i?.querySnapping)return[];const r=n.createQuery();this._layerView&&"effectiveDisplayFilter"in this._layerView&&(r.where=(0,l.mA)(r.where,this._layerView.effectiveDisplayFilter?.where));const o="returnZ"in n?n.returnZ:void 0,a=(0,h.nf)({parameters:e,mode:this.view?.type??"2d",returnZ:o,filter:r}),c=await i.querySnapping(a,{signal:t});(0,s.Te)(t);const u=e.coordinateHelper.spatialReference,p=await this._snappingElevationAligner.alignCandidates(c.candidates,u,t);(0,s.Te)(t);const y=await this._symbologySnappingFetcher.fetch(p,t);(0,s.Te)(t);const g=0===y.length?p:[...p,...y],f=this._snappingElevationFilter.filter(a,g),_=this._memoizedMakeGetGroundElevation(this.view,u);return f.map(e=>(0,d.$)(e,_))}};(0,i._)([(0,c.MZ)({constructOnly:!0})],_.prototype,"layerSource",void 0),(0,i._)([(0,c.MZ)({constructOnly:!0})],_.prototype,"view",void 0),(0,i._)([(0,c.MZ)()],_.prototype,"_snappingElevationAligner",null),(0,i._)([(0,c.MZ)()],_.prototype,"_snappingElevationFilter",null),(0,i._)([(0,c.MZ)()],_.prototype,"_symbologySnappingFetcher",null),(0,i._)([(0,c.MZ)()],_.prototype,"_layerView",null),(0,i._)([(0,c.MZ)()],_.prototype,"_layerView3D",null),(0,i._)([(0,c.MZ)()],_.prototype,"_symbologySnappingSupported",null),_=(0,i._)([(0,u.$)("esri.views.interactive.snapping.featureSources.FeatureCollectionSnappingSource")],_)}}]);
//# sourceMappingURL=77567.561b6601.chunk.js.map